import ArticleHeader from "@modules/article/ArticleHeader";
import ArticleImage from "@modules/article/ArticleImage";
import getArticleHeaderProps from "@modules/metadata/getArticleHeaderProps";
import getArticleJsonLdProps from "@modules/metadata/getArticleJsonLdProps";
import getArticleMetadata from "@modules/metadata/getArticleMetadata";
import { ArticleJsonLd } from "next-seo";
import gifss from "./gifss.gif";
import { item } from "./metadata";
import prag from "./o.jpg";
import o1 from "./o1.png";
import oo from "./oo.png";

{/* ---------------------------------------------------------- */}
{/* ---------------------------------------------------------- */}
{/* ---------------------------------------------------------- */}

export const metadata = getArticleMetadata(item);

<ArticleJsonLd {...getArticleJsonLdProps(item)} />

<ArticleHeader {...getArticleHeaderProps(item)} />

{/* ---------------------------------------------------------- */}
{/* ---------------------------------------------------------- */}
{/* ---------------------------------------------------------- */}

<ArticleImage
  img={prag}
  alt="ë‘ë ì— ë¹ ì§„ ì°¨ë¥¼ ë°€ê³  ìˆëŠ” ì‚¬ëŒë“¤"
  caption={
    <>
      ì–´ë–»ê²Œë“  ë¹ ì ¸ë‚˜ê°€ì•¼ í•œë‹¤! Photo by{" "}
      <a href="https://unsplash.com/@octoberroses?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">
        Aubrey Odom
      </a>{" "}
      on{" "}
      <a href="https://unsplash.com/photos/T1L9Q5g7eIQ?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">
        Unsplash
      </a>
    </>
  }
/>

[GraphQL](https://graphql.org/)ì´ë€ API ê¸°ìˆ  ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. [API](https://aws.amazon.com/ko/what-is/api)ë€ í•˜ë‚˜ì˜ í”„ë¡œê·¸ë¨ì—ì„œ ë‹¤ë¥¸ í”„ë¡œê·¸ë¨ìœ¼ë¡œ ìš”ì²­ì„ ì£¼ê³ ë°›ì„ ë•Œ ì‚¬ìš©í•˜ëŠ” ê¸°ìˆ ì¸ë°ìš”, ë³´í†µì€ í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ê°€ ìš”ì²­ì„ ì£¼ê³ ë°›ì„ ë•Œë¥¼ ì¼ì»«ìŠµë‹ˆë‹¤. í”„ë¡œê·¸ë¨ì´ ë‚˜ë‰˜ì–´ì ¸ ìˆëŠ” ê°€ì¥ í° ì´ìœ ëŠ” ê·¸ëƒ¥ ëŒì•„ê°€ëŠ” ì»´í“¨í„°ê°€ ë‹¤ë¥´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì›¹ì•±ì„ ìƒê°í•´ë´…ì‹œë‹¤. ê³ ê°ì´ ì´ìš©í•˜ëŠ” ë¸Œë¼ìš°ì €ê°€ ìˆìŠµë‹ˆë‹¤. ë§¥ë¶ì´ë‚˜ ìœˆë„ìš° ë°ìŠ¤í¬í†±, íƒœë¸”ë¦¿, ì•„ì´í°ì´ë‚˜ ì‚¼ì„± ê°¤ëŸ­ì‹œê°€ ë  ìˆ˜ ìˆê² ì£ . ë°˜ë©´ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” ìª½ì—ì„œëŠ” AWS ë‚˜ ì§ì ‘ êµ¬ì¶•í•œ ì„œë²„ì—ì„œ í”„ë¡œê·¸ë¨ì´ ëŒì•„ê°ˆ ê²ƒì…ë‹ˆë‹¤. ì´ ë‘˜ ì‚¬ì´ì—ì„œëŠ” í†µì‹ ì´ í•„ìš”í•˜ê³ , ê·¸ ë°©ë²•ì„ API ë ˆì´ì–´ì—ì„œ ì œê³µí•´ì¤€ë‹¤ëŠ” ëŠë‚Œì…ë‹ˆë‹¤.

ê°€ì¥ í”í•˜ê³  ë§ì´ ì“°ì´ëŠ” ë°©ì‹ì€ RESTì…ë‹ˆë‹¤. REST. ì¢‹ì£ . í•˜ì§€ë§Œ ì´ ê¸€ì—ì„œëŠ” GraphQLê³¼ RESTë¥¼ ë¹„êµí•˜ê³  ì¥ë‹¨ì ì„ ë”°ì§€ê³  í•  ê±´ ì•„ë‹ˆê¸° ë•Œë¬¸ì—, ì¿¨í•˜ê³  ìŠ¤ë¬´ìŠ¤í•˜ê²Œ ë„˜ì–´ê°€ê² ìŠµë‹ˆë‹¤.

í•˜ì—¬íŠ¼, ì¶•í•˜ë“œë¦½ë‹ˆë‹¤. GraphQLì„ ì‚¬ìš©í•˜ê² ë‹¤ê³  ë§ˆìŒë¨¹ì—ˆêµ°ìš”. ê·¸ë¦¬ê³  ë³´í†µ [Node.js](https://nodejs.org/) í™˜ê²½ì—ì„œ ê°œë°œì„ í•  í…Œë‹ˆ, [íƒ€ì…ìŠ¤í¬ë¦½íŠ¸](https://www.typescriptlang.org/)ì™€ë„ í”¼í•  ìˆ˜ ì—†ëŠ” ìš´ëª…ì¼ ê²ƒì…ë‹ˆë‹¤.

íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ê¸°ë°˜ í”„ë¡œì íŠ¸(ì„œë²„ë“ , í´ë¼ì´ì–¸íŠ¸ë“ )ì—ì„œ. ì€ê·¼. GraphQL ê°œë°œì´ ì¢€ ì–´ë µìŠµë‹ˆë‹¤. ì™œëƒí•˜ë©´ GraphQLì€ API ì— ëŒ€í•œ ëª…ì„¸ë¥¼ ì§€ì •í•´ì¤„ ë¿ì´ê³ , íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë‘ ì „í˜€ ì—°ê´€ì´ ì—†ê±°ë“ ìš”. ìš°ë¦¬ê°€ ì¼ì¼íˆ ì—°ê²°ê³ ë¦¬ë¥¼ ë§Œë“¤ì–´ì¤˜ì•¼ í•©ë‹ˆë‹¤.

íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì™€ GraphQLì´ ë‚˜ì˜¨ì§€ ì‹œê°„ì´ íë¥´ë©´ì„œ ì¡°ê¸ˆ ë” íš¨ìœ¨ì ìœ¼ë¡œ ì—°ê²°ê³ ë¦¬ë¥¼ ë§Œë“œëŠ” ë°©ë²•ë“¤ì´ ê°œë°œë˜ì—ˆìŠµë‹ˆë‹¤. ì € ë˜í•œ ê³ ë¯¼ì— ê³ ë¯¼ì„ ê±°ë“­í–ˆìŠµë‹ˆë‹¤. GraphQLì„ ì˜ ì´ìš©í•˜ëŠ” ê²Œ ë§Œì¡±í•  ë§Œí•œ ìˆ˜ì¤€ì€ ì•„ë‹ˆì§€ë§Œ, ê³ ë¯¼ ë˜í•œ ê³„ì†í•˜ê³  ì‹¶ì§„ ì•ŠìŠµë‹ˆë‹¤. ì ë‹¹íˆ ê²°ë¡ ì„ ì§“ê³  ì‹¶ì–´ ê¸€ì„ ì“°ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

ì´ ê¸€ì€ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì™€ GraphQL ì— ëŒ€í•œ ê²½í—˜ì´ ìˆì–´ì•¼ ì¢€ ì´í•´ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì•„ì§ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì— ìµìˆ™í•˜ì§€ ì•Šê±°ë‚˜ GraphQL ì— ì…ë¬¸í•œì§€ ì–¼ë§ˆ ë˜ì§€ ì•Šì€ ë¶„ì€ ì–¸ì  ê°€ ë‹¤ì‹œ ì°¾ì•„ì˜¤ê¸° ìœ„í•´ ì¦ê²¨ì°¾ê¸° í•´ì£¼ì‹œê¸° ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ë‹¤ì‹œ ì •ë¦¬í•˜ì£ . íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ê¸°ë°˜ í”„ë¡œì íŠ¸ì—ì„œ GraphQLë¥¼ ì¡°ê¸ˆì´ë¼ë„ ë” ìˆ˜ì›”í•˜ê²Œ ê°œë°œí•˜ê¸° ìœ„í•œ ë°©ë²• = codegen ì„ ì•Œë ¤ë“œë¦¬ê³ ì í•©ë‹ˆë‹¤.

## ìŠ¤í‚¤ë§ˆê°€ ê°€ì¥ ë¨¼ì €

ì•ì„œ ì´ì•¼ê¸°í–ˆë“¯ APIëŠ” ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ê°€ ì–´ë–»ê²Œ í†µì‹ í•  ìˆ˜ ìˆì„ì§€ë¥¼ ì •í•´ì¤ë‹ˆë‹¤. ìŠ¬í”„ê²Œë„ ë³´í†µ í´ë¼ì´ì–¸íŠ¸ê°€ "ì„"ì…ë‹ˆë‹¤. ì–´ë–¤ ì‘ë‹µì„ ë°›ê³  ì–´ë–»ê²Œ ì²˜ë¦¬í•´ì¤„ì§€ëŠ” ì„œë²„ì— ì½”ë“œê°€ ë‹¤ ìˆê±°ë“ ìš”.

ê·¸ë ‡ë‹¤ê³  í•´ì„œ í”„ë¡ íŠ¸ ê°œë°œìê°€ ì„ì´ë¼ëŠ” ê±´ ì•„ë‹™ë‹ˆë‹¤. ìš°ë¦¬ëŠ” í˜‘ì—…ì„ í•´ì•¼ í•©ë‹ˆë‹¤. ë§Œì•½ ë‚˜ í˜¼ì ë°±ì—”ë“œë„ í•˜ê³  í”„ë¡ íŠ¸ë„ í•˜ëŠ” í’€ìŠ¤íƒì´ë¼ë©´ ì´ì¤‘ì¸ê²©ìê°€ ë˜ì–´ ìŠ¤ìŠ¤ë¡œì™€ ëŒ€í™”í•´ì•¼ í•©ë‹ˆë‹¤. ì–´ë–»ê²Œ ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ëŠ” ê²Œ ì¢‹ì„ê¹Œ? ê·¸ ì•½ì†ì„ ì •í•˜ëŠ” ê²ƒì´ ë¨¼ì €ì…ë‹ˆë‹¤. [OpenAPI](https://www.openapis.org/)ì™€ ê°™ì€ íˆ´ì´ ìˆëŠ” ì´ìœ ê¸°ë„ í•˜ì£ . GraphQL ì—ì„œëŠ” ê·¸ ì•½ì†ì„ ìŠ¤í‚¤ë§ˆë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.

ì•„ë˜ëŠ” ChatGPT í•œí…Œ GraphQL ìƒ˜í”Œ ìŠ¤í‚¤ë§ˆë¥¼ ë§Œë“¤ì–´ë‹¬ë¼ê³  ìš”ì²­í•œ ê²°ê³¼ì…ë‹ˆë‹¤. ì§ì ‘ ì‚¬ìš©í•  ê±´ ì•„ë‹ˆê³  ê·¸ëƒ¥ ì°¸ê³ ìš©ìœ¼ë¡œë§Œ ë´ì£¼ì„¸ìš”. `schema.graphql` íŒŒì¼ì…ë‹ˆë‹¤. ì´ ìŠ¤í‚¤ë§ˆ íŒŒì¼ì€ ë°±ì—”ë“œì— ìˆì„ ê²ë‹ˆë‹¤.

```graphql schema.graphql
type Query {
  getUser(id: ID!): User
  allUsers: [User!]!
}

type Mutation {
  createUser(input: CreateUserInput!): User!
  updateUser(id: ID!, input: UpdateUserInput!): User
  deleteUser(id: ID!): Boolean!
}

type User {
  id: ID!
  name: String!
  email: String!
  age: Int
  posts: [Post!]!
}

type Post {
  id: ID!
  title: String!
  content: String!
  author: User!
}

input CreateUserInput {
  name: String!
  email: String!
  age: Int
}

input UpdateUserInput {
  name: String
  email: String
  age: Int
}
```

ë¬¸ë²•ì€ ë‹¤ë“¤ í•˜ì‹œì£ ? ê·¸ë˜ë„ ê°„ëµí•˜ê²Œ ì–¸ê¸‰í•˜ê² ìŠµë‹ˆë‹¤.

- ì¿¼ë¦¬ëŠ” ì½ê¸° ìœ„í•œ ìš©ë„ì´ê³  ë®¤í…Œì´ì…˜ì€ ë³€ê²½í•˜ê¸° ìœ„í•œ ìš©ë„ì…ë‹ˆë‹¤. [CQRS](https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs) íŒ¨í„´ê³¼ ì—°ê´€ì´ ìˆìŠµë‹ˆë‹¤.
- `!`ê°€ ìˆìœ¼ë©´ í•„ìˆ˜ë¼ëŠ” ëœ»ì´ê³ , `!`ì—†ìœ¼ë©´ ê·¸ ë°ì´í„°ê°€ ìˆì–´ë„ ë˜ê³  ì—†ì–´ë„ ë˜ê³  ë„¤ ë§˜ëŒ€ë¡œ í•˜ë¼ëŠ” ëœ»ì…ë‹ˆë‹¤. `[TYPE]!` (`!`ê°€ ë°°ì—´ ë°”ê¹¥ì— ìˆìŒ)ëŠ” ë°°ì—´ ê·¸ ìì²´ì— ëŒ€í•œ í•„ìˆ˜ ì—¬ë¶€ê³  `[TYPE!]` (`!`ê°€ ë°°ì—´ ì•ˆì— ìˆìŒ)ì€ ë°°ì—´ ì•„ì´í…œì— ëŒ€í•œ í•„ìˆ˜ ì—¬ë¶€ë¥¼ ëœ»í•©ë‹ˆë‹¤.
- ì¿¼ë¦¬/ë®¤í…Œì´ì…˜ì˜ ë¦¬í„´ ê°’ì€ `type`ìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.
- ì¿¼ë¦¬/ë®¤í…Œì´ì…˜ì˜ ì¸ì ê°’ì€ `input`ìœ¼ë¡œë§Œ êµ¬ì„±ë©ë‹ˆë‹¤.

## ë™ì‘ êµ¬í˜„í•˜ê¸°

Node.jsì—ì„œ RESTë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•´ expressì™€ ê°™ì€ ì›¹ì„œë²„ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ê³ , í´ë¼ì´ì–¸íŠ¸ì—ì„œëŠ” fetch ë“±ìœ¼ë¡œ ìš”ì²­ì„ ë‚ ë¦½ë‹ˆë‹¤. GraphQL ë˜í•œ ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ê¸° ìœ„í•œ ì„œë²„ì¸¡ ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ í´ë¼ì´ì–¸íŠ¸ì¸¡ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ìˆìŠµë‹ˆë‹¤. ì§€ê¸ˆ 2023ë…„. ì‚¬ëŒë“¤ì´ ê°€ì¥ í”í•˜ê²Œ ì°¾ëŠ” ë„êµ¬ëŠ” [Apollo Server](https://www.apollographql.com/docs/apollo-server/) ì™€ [Apollo Client](https://www.apollographql.com/docs/react) ì…ë‹ˆë‹¤.

### ì„œë²„ ì˜ˆì œ

ì € `graphql.schema` íŒŒì¼ì€ APIê°€ ë¬´ì—‡ì¸ì§€ë§Œ ì•Œë ¤ì¤„ ë¿, APIê°€ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ëŠ” ì „í˜€ ê´€ì—¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê·¸ êµ¬í˜„ì€ ë°±ì—”ë“œ ê°œë°œìì˜ ëª«ì…ë‹ˆë‹¤. êµ¬í˜„ì„ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¡œ í•´ì•¼ê² ì£ ?

ì•„ë˜ ì½”ë“œë„ ChatGPT í•œí…Œ ë§¡ê²¼ìŠµë‹ˆë‹¤. ëŒì•„ê°€ëŠ” ì½”ë“œëŠ” ì•„ë‹™ë‹ˆë‹¤!

```tsx sample-server.ts
import { ApolloServer } from "apollo-server";
import fs from "fs";
import path from "path";

// GraphQL ìŠ¤í‚¤ë§ˆ ë¡œë“œ
const typeDefs = fs.readFileSync(
  path.join(__dirname, "./graphql.schema"),
  "utf8",
);

// ë¦¬ì¡¸ë²„
const resolvers = {
  Query: {
    getUser: (_: any, { id }: { id: string }) => {
      // TODO: ë°ì´í„° ì¡°íšŒ ë¡œì§ ì‘ì„±
    },
    allUsers: () => {
      // TODO: ëª¨ë“  ì‚¬ìš©ì ì¡°íšŒ ë¡œì§ ì‘ì„±
    },
  },
  Mutation: {
    createUser: (_: any, { input }: { input: any }) => {
      // TODO: ì‚¬ìš©ì ìƒì„± ë¡œì§ ì‘ì„±
    },
    updateUser: (_: any, { id, input }: { id: string; input: any }) => {
      // TODO: ì‚¬ìš©ì ì—…ë°ì´íŠ¸ ë¡œì§ ì‘ì„±
    },
    deleteUser: (_: any, { id }: { id: string }) => {
      // TODO: ì‚¬ìš©ì ì‚­ì œ ë¡œì§ ì‘ì„±
    },
  },
  User: {
    posts: (user: any) => {
      // TODO: ì‚¬ìš©ìì˜ ê²Œì‹œê¸€ ì¡°íšŒ ë¡œì§ ì‘ì„±
    },
  },
};

// ì„œë²„ ìƒì„± ë° ì‹œì‘
const server = new ApolloServer({ typeDefs, resolvers });

server.listen().then(({ url }) => {
  console.log(`ğŸš€ Server ready at ${url}`);
});
```

ì, ì—¬ê¸°ì„œ ë¬¸ì œì ì´ ë¬´ì—‡ì¼ê¹Œìš”? **ë°”ë¡œ ì¸ìì˜ íƒ€ì…ì„ `{ input: any }` ì™€ ê°™ì´ ì§ì ‘ ì‘ì„±í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.** input ì˜ íƒ€ì…ì„ anyë¡œ ë‘”ë‹¤ë©´ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì˜ í•µì‹¬ì¸ íƒ€ì… ì²´í¬ ê¸°ëŠ¥ì„ ì“°ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤.

ê·¸ë ‡ë‹¤ê³  ì§ì ‘ íƒ€ì…ì„ ë§Œë“œëŠ” ê²ƒë„ ë¬¸ì œì…ë‹ˆë‹¤. ìš°ë¦¬ê°€ ë§Œë“  íƒ€ì…ì´ GraphQLì—ì„œ ì§€ì •í•œ íƒ€ì…ê³¼ ë¯¸ì„¸í•˜ê²Œ ë‹¤ë¥´ë‹¤ë©´? ì˜¤íƒ€ ê°™ì€ê±´ ì¶©ë¶„íˆ ë‚  ìˆ˜ ìˆì£ . íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ìƒìœ¼ë¡œëŠ” ì—ëŸ¬ê°€ ì—†ê² ì§€ë§Œ ì‹¤ì œ ë™ì‘í•  ë•Œì—” í•„ë“œê°€ ì—†ë‹¤ë©° ì—ëŸ¬ë¥¼ ë¿œì–´ë‚¼ ê²ƒì…ë‹ˆë‹¤! íƒ€ì…ì´ ì˜ëª» ì§€ì •ë˜ì–´ ìˆì„ ë•Œ ë°œìƒí•˜ëŠ” ì—ëŸ¬ëŠ” ì›ì¸ì„ ì°¾ê¸°ê°€ ì–´ë µìŠµë‹ˆë‹¤. anyë¥¼ ì“°ëŠ” ê²Œ ì°¨ë¼ë¦¬ ë” ë‚˜ì„ ìˆ˜ë„?

ì¸ìì˜ íƒ€ì… ë¿ë§Œ ì•„ë‹ˆë¼ **ë¦¬í„´ íƒ€ì…**ë„ ì •í•´ì ¸ìˆì§€ ì•Šìœ¼ë¯€ë¡œ ìš°ë¦¬ëŠ” í—ˆê³µìœ¼ë¡œ ëŒì„ ë˜ì ¸ ì •ë‹µì„ ë§ì¶°ì•¼ í•©ë‹ˆë‹¤. ì—ëŸ¬ê°€ ì‹œí•œí­íƒ„ì²˜ëŸ¼ ê½ê½ ìˆ¨ê²¨ì ¸ 2ê°œì›” ë’¤ì— í„°ì§ˆ ìˆ˜ë„ ìˆì£ ! ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ì œëŒ€ë¡œ ë§Œë“¤ì–´ ì „ë‹¬í•´ì¤€ë‹¤ê³  ì°©ê°í•´ë²„ë¦¬ëŠ” ê²ƒì…ë‹ˆë‹¤. ë„ˆë¬´ ìŠ¬í¼ìš”.

### í´ë¼ì´ì–¸íŠ¸ ì˜ˆì œ

ì•„ë˜ ì½”ë“œ ë˜í•œ ì˜ˆì œì…ë‹ˆë‹¤. ê°“ì§€í”¼í‹°ì˜ í˜ì„ ë¹Œë ¸ìŠµë‹ˆë‹¤.

```tsx sample-client.tsx
import { gql, useQuery } from "@apollo/client";
import React from "react";

const GET_USER = gql`
  query GetUser($id: ID!) {
    getUser(id: $id) {
      id
      name
      email
      age
    }
  }
`;

const UserComponent: React.FC = () => {
  const { loading, error, data } = useQuery(GET_USER, {
    variables: { id: "1" },
  });

  if (loading) return <p>Loading...</p>;
  if (error) return <p>Error: {error.message}</p>;

  const user = data.getUser;

  return (
    <div>
      <h1>{user.name}</h1>
      <p>Email: {user.email}</p>
      <p>Age: {user.age || "Not available"}</p>
    </div>
  );
};

export default UserComponent;
```

ì, ì—¬ê¸°ì„œë„ ë¬¸ì œê°€ ë§ìŠµë‹ˆë‹¤.

- ``gql`...` `` ì— ìˆëŠ” Document ê°€ schema.graphql ì— ì í˜€ì ¸ìˆëŠ” ëŒ€ë¡œ ì œëŒ€ë¡œ ìš”ì²­í•˜ê³  ìˆëŠ”ì§€ ì•Œê¸° í˜ë“­ë‹ˆë‹¤. ì—†ëŠ” í•„ë“œë¥¼ ìš”ì²­í•œë‹¤ë“ ì§€ì™€ ê°™ì€ ë¬¸ì œëŠ” ì‹¤ì œ ë™ì‘ ì „ê¹Œì§„ ì•Œ ìˆ˜ ì—†ì£ .
- `variables`(ì¸ì)ì— ì–´ë–¤ ê°’ì´ ë“¤ì–´ê°€ì•¼ í•˜ëŠ”ì§€ ì•Œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‘ì„±ëœ ì¿¼ë¦¬ë¥¼ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” í•˜ë‚˜ì˜ íŒŒì¼ ì•ˆì— ëª°ì•„ë„£ì–´ì„œ í° ê´€ê³„ëŠ” ì—†ì§€ë§Œ, íŒŒì¼ì´ ë§Œì•½ ë¶„ë¦¬ëœë‹¤ë©´? ìš°ë¦¬ ë‡ŒëŠ” ìŠ¬ìŠ¬ ì§€ì³ê°€ê¸° ì‹œì‘í•©ë‹ˆë‹¤.
- `data`(ê²°ê³¼) ì— ì–´ë–¤ ë°ì´í„°ê°€ ìˆëŠ”ì§€ ì•Œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‘ì„±ëœ ìŠ¤í‚¤ë§ˆ íŒŒì¼ì„ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤. ë¶ˆì•ˆì— ë–¨ë©´ì„œ í•„ë“œì— ì ‘ê·¼í•´ì•¼ í•©ë‹ˆë‹¤.

ì´ë ‡ë“¯ GraphQL ì„ ì‚¬ìš©í•˜ë‹¤ë³´ë©´ TypeScriptë¥¼ í‡´ìƒ‰ì‹œí‚¤ëŠ” ê²ƒ íˆ¬ì„±ì…ë‹ˆë‹¤.

ì—¬ê¸°ì„œ ìš°ë¦¬ì˜ êµ¬ì„¸ì£¼, ì•„ë‹ˆ êµ¬ì„¸ì£¼ ê¹Œì§„ ì•„ë‹ˆê³  ê·¸ëƒ¥ ë™ë°˜ìë¼ê³  í• ê²Œìš”. ë™ë°˜ìê°€ ë‚˜ì™”ìŠµë‹ˆë‹¤. ê·¸ ì´ë¦„ì€ [codegen](https://the-guild.dev/graphql/codegen). ê°œë°œ ê²½í—˜ì´ ì© ë§¤ë„ëŸ½ì§„ ì•Šê³ , ìš¸ë©° ê²¨ìë¨¹ê¸°ë¡œ í•˜ëŠ” ëŠë‚Œì´ë¼ ë™ë°˜ìë¡œ ì¹­í–ˆìŠµë‹ˆë‹·. ìš¸ë©° ê²¨ìë¨¹ê¸°ì¸ ì´ìœ ëŠ” ì¶”í›„ ë”°ë¡œ ë§ì”€ë“œë¦¬ì£ .

## í”„ë¡œì íŠ¸ ì„¸íŒ…

https://github.com/echoja/graphql-union

ìš°ì„  ë“¤ì–´ê°€ì„œ `git clone` ì„ í•´ë³´ì‹œì£ . ì„¤ëª…ì€ ì¤‘êµ¬ë‚œë°©ì¼ ê²ƒì…ë‹ˆë‹¤.

ìš°ë¦¬ì˜ ë ˆí¬ëŠ” ë­ ì´ë¯¸ ë‹¤ ì„¸íŒ…ë˜ì–´ ìˆëŠ” ìƒíƒœë¼ì„œ, ì•„ë˜ì™€ ê°™ì´ ëª…ë ¹ì–´ë¥¼ ì¹œ ë‹¤ìŒ

```bash
npm install
npm dev
```

[localhost:3000](http://localhost:3000) ìœ¼ë¡œ ë“¤ì–´ê°€ë©´ ë­”ê°€ ëŒì•„ê°€ëŠ” ê±¸ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜ ì§ì ‘ íŒ¨í‚¤ì§€ ì„¤ì¹˜ë¶€í„° ì„¸íŒ…í•˜ê³  ì‹¶ìœ¼ì‹  ë¶„ë“¤ì„ ìœ„í•´ ì•„ë˜ ì£¼ì ˆì£¼ì ˆ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤. í”„ë¡œì íŠ¸ êµ¬ì„±ì— ê´€í•œ ì„¤ëª…ì„ íŒ¨ìŠ¤í•˜ê³  ì‹¶ë‹¤ë©´, ë°”ë¡œ "ì½”ë“œ ì„¤ëª…" ìœ¼ë¡œ ë„˜ì–´ê°€ì…”ë„ ì¢‹ìŠµë‹ˆë‹¤.

í”„ë¡ íŠ¸ ë° ì›¹ì„œë²„ëŠ” Next.jsë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. Apollo Client ë„ ì‚¬ìš©ë©ë‹ˆë‹¤. API ì„œë²„ëŠ” Node.js ê¸°ë°˜ Apollo Server ë¡œ êµ¬ì„±ë˜ì—ˆìŠµë‹ˆë‹¤. (ì—„ë°€íˆ í•˜ë©´ Next.js ì—ì„œ App Router ë¥¼ ì´ìš©í–ˆê¸° ë•Œë¬¸ì— í´ë¼ì´ì–¸íŠ¸ì—ì„œ api ì„œë²„ë¡œê°€ ì•„ë‹Œ ì„œë²„ì—ì„œ ì„œë²„ë¡œ ìš”ì²­ì„ ì£¼ê³  ë°›ëŠ” í˜•íƒœê°€ ëìŠµë‹ˆë‹¤.) ì—¬ëŸ¬ í”„ë¡œì íŠ¸ë¥¼ í•˜ë‚˜ì˜ ë¦¬í¬ì§€í† ë¦¬ì—ì„œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ [npm workspaces](https://docs.npmjs.com/cli/using-npm/workspaces) ê°œë…ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

ì•„ë¬´ ê²ƒë„ ì—†ëŠ” í……í…… ë¹ˆ Root í”„ë¡œì íŠ¸ì—ì„œ ìƒˆë¡­ê²Œ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ë¥¼ êµ¬ì„±í•˜ë ¤ë©´ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì¹˜ë©´ ë©ë‹ˆë‹¤.

```bash
npm init -w api-server
npm init -w web
```

ì´ë ‡ê²Œ í•˜ë©´ ê°ê°ì˜ í”„ë¡œì íŠ¸ í´ë”ê°€ ìƒê¸°ë©´ì„œ, ë‚´ë¶€ì— package.json íŒŒì¼ì´ ìƒì„±ë  ê²ƒì…ë‹ˆë‹¤. ê·¸ëŸ¬ê³¤ ë£¨íŠ¸ í”„ë¡œì íŠ¸ì˜ `package.json` íŒŒì¼ì„ ì‚´í´ë³´ë©´ ë‘ ê°œì˜ workspace ê°€ ì¶”ê°€ë˜ì—ˆë‹¤ëŠ” ì‚¬ì‹¤ì„ ë°œê²¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```json package.json
"workspaces": [
  "api-server",
  "web"
],
```

`npm init -w ê²½ë¡œì´ë¦„` ëª…ë ¹ì–´ë¥¼ ì¹  ë•Œë§ˆë‹¤ ë£¨íŠ¸ í”„ë¡œì íŠ¸ì˜ `package.json`, `package-lock.json`, í•˜ìœ„ í”„ë¡œì íŠ¸ì˜ `package.json` ì´ ë³€ê²½/ì¶”ê°€ ë©ë‹ˆë‹¤. ì´ì™€ ê°™ì´ ëª¨ë…¸ë ˆí¬ ì‹ìœ¼ë¡œ êµ¬ì„±í•˜ê²Œ ëì„ ë•Œ `package-lock.json` ê³¼ ê°™ì€ ë½ íŒŒì¼ì´ ì „ì²´ í´ë”ì—ì„œ í•˜ë‚˜ë§Œ ìˆë‹¤ëŠ” ì‚¬ì‹¤! pnpm(`pnpm-lock.yaml`) ìœ¼ë¡œ í•´ë„, yarn(`yarn.lock`) ìœ¼ë¡œ í•´ë„ ë§ˆì°¬ê°€ì§€ì…ë‹ˆë‹¤.

ì´ì œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚´í´ë³´ë©´ `codegen` ì´ ìˆìŠµë‹ˆë‹¤.

```json package.json
"scripts": {
  "codegen": "graphql-codegen --config codegen.ts"
},
```

codegenê³¼ ê´€ë ¨ëœ íŒ¨í‚¤ì§€ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

```json package.json
"devDependencies": {
  "@graphql-codegen/cli": "^5.0.0",
  "@graphql-codegen/client-preset": "^4.1.0",
  "@graphql-codegen/introspection": "^4.0.0",
  "@graphql-codegen/typescript": "^4.0.1",
  "@graphql-codegen/typescript-operations": "^4.0.1",
	"@graphql-codegen/typescript-resolvers": "^4.0.1",
  "@graphql-typed-document-node/core": "^3.2.0",
  "prettier": "^3.0.3",
}
```

ë­ê°€ ë˜ê²Œ ë§ë„¤ìš”â€¦ ìœ„ íŒ¨í‚¤ì§€ë¥¼ ëª¨ë‘ ì„¤ì¹˜í•˜ë ¤ë©´ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì¹˜ë©´ ë©ë‹ˆë‹¤.

```bash
npm install -D @graphql-codegen/cli @graphql-codegen/client-preset @graphql-codegen/introspection @graphql-codegen/typescript @graphql-codegen/typescript-operations @graphql-typed-document-node/core prettier
```

ì›¹ì€ Next.js ë¡œ í–ˆìŠµë‹ˆë‹¤. í•µì‹¬ì€ Apollo Client ê² ì£ ?

```bash
# ë£¨íŠ¸ í”„ë¡œì íŠ¸ì—ì„œ ì‹¤í–‰
rm web/package.json
npx create-next-app@latest web
npm install @apollo/client -w web
npm install -D graphql prettier -w web
```

api-server ëŠ” ê°„ë‹¨í•œ Node.js ì„œë²„ì´ì§€ë§Œ, dev ëª¨ë“œë¥¼ ì†ì‰½ê²Œ í•˜ê¸° ìœ„í•´ tsup ì´ë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. Apollo Server ë„ í•¨ê»˜ ì„¤ì¹˜í•´ì¤ë‹ˆë‹¤.

```bash
# ë£¨íŠ¸ í”„ë¡œì íŠ¸ì—ì„œ ì‹¤í–‰
npm install @apollo/server -w api-server
npm install -D graphql prettier tsup -w api-server
```

ê·¸ì™¸ ëª¨ë…¸ë ˆí¬ ê´€ë¦¬ë¥¼ ìœ„í•´ [turborepo](https://turbo.build/) ë¼ëŠ” ê±¸ ì‚¬ìš©í•´ë´¤ëŠ”ë°, ë³„ ì˜ë¯¸ëŠ” ì—†ìœ¼ë‹ˆ íŒ¨ìŠ¤í•©ë‹ˆë‹¤.

`npm run codegen` í•´ì„œ ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì„±ê³µì…ë‹ˆë‹¤. ì•„ë§ˆ ì•„ë¬´ëŸ° ë³€í™”ê°€ ì—†ì„ ê²ë‹ˆë‹¤. ë¨¼ì € ì½”ë“œë¥¼ ê°„ëµí•˜ê²Œ ì„¤ëª…í•œ í›„, ì½”ë“œë¥¼ ë°”ê¾¸ê³  ë‹¤ì‹œ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

## ì½”ë“œ ì„¤ëª…

```tsx codegen.ts
import { CodegenConfig } from "@graphql-codegen/cli";

const config: CodegenConfig = {
  overwrite: true,
  generates: {
    "./web/generated/graphql/": {
      schema: ["./api-server/**/*.graphql"],
      documents: ["./web/**/*.tsx", "./web/**/*.ts", "!./web/generated/**/*"],
      hooks: {
        afterOneFileWrite: ["prettier --write"],
      },
      preset: "client",
      presetConfig: {
        gqlTagName: "gql",
      },
      config: {
        enumsAsTypes: true,
      },
    },
    "./api-server/generated/graphql.ts": {
      hooks: {
        afterOneFileWrite: ["prettier --write"],
      },
      schema: ["./api-server/**/*.graphql"],
      plugins: ["typescript", "typescript-resolvers"],
      config: {
        typesPrefix: "I",
        enumsAsTypes: true,
        skipTypename: false,
        scalars: {
          jsonb: "any",
          JSON: "any",
        },
      },
    },
  },
};

export default config;
```

- ë³¸ íŒŒì¼ì€ codegen í•  ë•Œì˜ ë™ì‘ ë°©ì‹ì„ ì •í•©ë‹ˆë‹¤. íŒŒì¼ì˜ ì´ë¦„ì€ ìƒê´€ì—†ê³  `graphql-codegen --config codegen.ts` ì™€ ê°™ì´ ì˜µì…˜ìœ¼ë¡œ ì˜ ì „ë‹¬í•´ì£¼ë©´ ë©ë‹ˆë‹¤. (package.json ìŠ¤í¬ë¦½íŠ¸ ì°¸ì¡°)
- `overwrite` ëŠ” ì½”ë“œì  ì´ ì‹¤í–‰í•  ë•Œ ê²°ê³¼ë¥¼ ë®ì–´ì”Œìš¸ì§€ë¥¼ ê²°ì •í•©ë‹ˆë‹¤.
- `generates` ëŠ” í‚¤ê°€ ìƒì„±í•  íŒŒì¼ í˜¹ì€ í´ë”ì˜ ê²½ë¡œê³ , ê·¸ ê°’ì€ í•´ë‹¹ ê²½ë¡œì— ë¬´ì—‡ì„ ì–´ë–»ê²Œ ìƒì„±í•  ê²ƒì¸ì§€ ì•Œë ¤ì¤ë‹ˆë‹¤.
- `schema` ë€ graphql ìŠ¤í‚¤ë§ˆ íŒŒì¼ì„ ëœ»í•©ë‹ˆë‹¤.
- `documents` ë€ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìš”ì²­í•˜ëŠ” ë¬¸ìì—´ì„ ëœ»í•©ë‹ˆë‹¤. (mutation, query ë‘˜ ë‹¤ ì˜ë¯¸í•¨)
- `hooks: { afterOneFileWrite: ["prettier --write"] }` ë€ íŒŒì¼ í•˜ë‚˜ê°€ ì“°ì—¬ì§ˆ ë•Œë§ˆë‹¤ `prettier` í¬ë§¤íŒ…ì„ í•˜ê² ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤. ìƒì„±ëœ ì½”ë“œë¥¼ ì½ê¸° í•œì¸µ ìˆ˜ì›”í•˜ë„ë¡ í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.
- `preset` ì´ë€ ìš©ë„ì— ë§ê²Œ ë¯¸ë¦¬ ì„¸íŒ…ëœ ì„¤ì •ì„ ê°€ì ¸ë‹¤ ì“°ê² ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤. í”„ë¦¬ì…‹ì´ ìˆëŠ” ì¤„ ìµœê·¼ì— ì•Œì•˜ìŠµë‹ˆë‹¤. ì—¬ëŸ¬ í”ŒëŸ¬ê·¸ì¸ê³¼ config ë¥¼ ì˜ êµ¬ì„±í•´ë†“ì€ ê²ƒ ê°™ìŠµë‹ˆë‹¤.
- `plugins` ì–´ë–¤ ì¢…ë¥˜ì˜ ì½”ë“œë¥¼ ìƒì„±í• ì§€ ê²°ì •í•©ë‹ˆë‹¤. [í”ŒëŸ¬ê·¸ì¸ì˜ ì¢…ë¥˜ëŠ” ì—„ì²­ ë§ìŠµë‹ˆë‹¤](https://the-guild.dev/graphql/codegen/plugins).
- `config`, `presetConfig` : í”ŒëŸ¬ê·¸ì¸ì´ë‚˜ í”„ë¦¬ì…‹ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì˜µì…˜ì…ë‹ˆë‹¤. í”ŒëŸ¬ê·¸ì¸ì´ ë§ì€ ë§Œí¼ ì˜µì…˜ë„ ë§ìŠµë‹ˆë‹¤. í•˜ë‚˜í•˜ë‚˜ ì„¤ì •í•˜ë‹¤ê°„ í•´ê°€ ì¤‘ì²œì— ìˆë‹¤ê°€ë„ ê¸ˆë°© ìˆ˜í‰ì„  ë„ˆë¨¸ë¡œ ì‚¬ë¼ì§ˆ ê²ƒì´ë‹ˆ, ì ë‹¹íˆ í•˜ëŠ” ê²Œ ì¢‹ìŠµë‹ˆë‹¤. enum ëŒ€ì‹  ìŠ¤íŠ¸ë§ ë¦¬í„°ëŸ´ ìœ ë‹ˆì˜¨ìœ¼ë¡œ êµ¬ì„±ëœ íƒ€ì…ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ `enumsAsTypes: true` ì˜µì…˜ ë¹¼ê³ ëŠ” ì“¸ë§Œí•œ ê±¸ ëª»ì°¾ì•˜ë˜ ê¸°ë¶„ì…ë‹ˆë‹¤.

í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ì—ì„œ ìš”êµ¬í•˜ëŠ” íŒŒì¼ì´ ì¢€ ë‹¤ë¥´ë‹¤ëŠ” ê±¸ ì§šê³  ë„˜ì–´ê°€ê² ìŠµë‹ˆë‹¤.

í´ë¼ì´ì–¸íŠ¸ì˜ ê²½ìš° ì‹¤ì œ ìš”ì²­ì„ ë‚ ë¦´ ë•Œ variables, ì„ íƒí•œ í•„ë“œ ê²°ê³¼ì— ëŒ€í•œ íƒ€ì…ì„ ì§€ì›ë°›ê¸° ìœ„í•´ì„œ documentê°€ í•„ìš”í•©ë‹ˆë‹¤. ê±°ê¸°ì— ë”í•´, ì–´ë–¤ í˜•ì‹ìœ¼ë¡œ ìš”ì²­ì„ ì¤„ ìˆ˜ ìˆëŠ”ì§€ì— ê´€í•œ `input` íƒ€ì…ì´ ìŠ¤í‚¤ë§ˆì— ëª…ì‹œë˜ì–´ ìˆìœ¼ë¯€ë¡œ ìŠ¤í‚¤ë§ˆë„ í•„ìš”í•©ë‹ˆë‹¤.

ë°˜ë©´ ì„œë²„ì—ì„œëŠ” ìŠ¤í‚¤ë§ˆì— ë§ê²Œë§Œ resolver ë¥¼ êµ¬ì„±í•´ì£¼ë©´ ë©ë‹ˆë‹¤. ê·¸ë˜ì„œ document ëŠ” í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.

---

```graphql api-server/src/schema.graphql
# This "Book" type defines the queryable fields for every book in our data source.
type Novel {
  title: String!
  author: String!
  genre: String!
}

type Comic {
  title: String!
  author: String!
  illustrator: String!
}

type Biography {
  title: String!
  author: String!
  subject: String!
}

union Book = Novel | Comic | Biography

type Query {
  books(type: BookType): [Book!]!
}

enum BookType {
  NOVEL
  COMIC
  BIOGRAPHY
}

type Query {
  books: [Book!]!
}
```

ì„œë²„ì—ì„œì˜ ìŠ¤í‚¤ë§ˆì…ë‹ˆë‹¤. ê°„ë‹¨í•˜ì£ ? Mutation ì€ ì—†ìŠµë‹ˆë‹¤. ì±…(Book)ì„ ì„¸ ì¢…ë¥˜ë¡œ í–ˆê³ , union ìœ¼ë¡œ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

ì´ ìŠ¤í‚¤ë§ˆ íŒŒì¼ì„ ì´ìš©í•˜ë„ë¡ ì„œë²„ ì½”ë“œë¥¼ ê°„ëµí•˜ê²Œ ì§œë´…ì‹œë‹¤.

```tsx api-server/src/index.ts
import { ApolloServer, BaseContext } from "@apollo/server";
import { startStandaloneServer } from "@apollo/server/standalone";
import { readFileSync } from "fs";
import { books } from "./books";
import { IResolvers } from "./generated/graphql";

const typeDefs = readFileSync("src/schema.graphql").toString("utf-8");

// Resolvers define how to fetch the types defined in your schema.
// This resolver retrieves books from the "books" array above.

const resolvers: IResolvers = {
  Query: {
    books: async (_parent, args) => {
      switch (args.type) {
        case "NOVEL":
          return books.filter((book) => book.__typename === "Novel");
        case "BIOGRAPHY":
          return books.filter((book) => book.__typename === "Biography");
        case "COMIC":
          return books.filter((book) => book.__typename === "Comic");
        default:
          return books;
      }
    },
  },
};

// The ApolloServer constructor requires two parameters: your schema
// definition and your set of resolvers.
const server = new ApolloServer<BaseContext>({
  typeDefs,
  resolvers,
});

// Passing an ApolloServer instance to the `startStandaloneServer` function:
//  1. creates an Express app
//  2. installs your ApolloServer instance as middleware
//  3. prepares your app to handle incoming requests
const { url } = await startStandaloneServer(server, {
  listen: { port: 4000 },
});

console.log(`ğŸš€  Server ready at: ${url}`);
```

Query ì˜ `books` í•˜ë‚˜ ë°–ì— ì—†ì—ˆê¸° ë•Œë¬¸ì—, resolverë¥¼ í•˜ë‚˜ë§Œ ë§Œë“¤ì–´ì£¼ë©´ ë©ë‹ˆë‹¤. ëŒ€ì¶© `books`ë¼ëŠ” ëª©ì—… ë°ì´í„°ë¥¼ ë°›ì•„ì™€ì„œ ì²˜ë¦¬í•©ë‹ˆë‹¤.

```tsx api-server/src/books.ts
import { IBook } from "./generated/graphql";

export const books: IBook[] = [
  {
    __typename: "Novel",
    title: "The Catcher in the Rye",
    author: "J.D. Salinger",
    genre: "Coming-of-age fiction",
  },
  /// ì¤‘ëµ
];
```

ì—¬ê¸°ì„œ ì£¼ëª©í•´ì•¼ í•  ì ì€ `IResolvers` íƒ€ì…ì…ë‹ˆë‹¤. ì´ê²Œ ì½”ë“œì  ì—ì„œ ë§Œë“¤ì–´ì£¼ëŠ” íƒ€ì…ì´ê±°ë“ ìš”.

ì´ ì„œë²„ë¥¼ ì‹¤ì œë¡œ ì–´ë–»ê²Œ êµ¬ë™í•  ì§€ëŠ” `/api-server/package.json` íŒŒì¼ì„ ì°¸ì¡°í•´ì£¼ì„¸ìš”. ì¼ë‹¨ `npm run dev` ì— ë‹¤ í¬í•¨ì‹œì¼œë†“ê¸´ í–ˆìŠµë‹ˆë‹¤.

ê·¸ ë‹¤ìŒìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ ìª½ ì½”ë“œë¥¼ í™•ì¸í•´ë´…ì‹œë‹¤.

```tsx web/app/type/[type]/page.tsx
import { Biography, Comic, Novel } from "@/components/book";
import { gql } from "@/generated/graphql";
import { BookType } from "@/generated/graphql/graphql";
import { client } from "@/graphql";

export default async function Books({
  params,
}: {
  params: { type: BookType };
}) {
  const res = await client.query({
    query: gql(/* GraphQL */ `
      query BooksByType($type: BookType) {
        books(type: $type) {
          ... on Novel {
            author
            title
            genre
          }
          ... on Comic {
            author
            title
            illustrator
          }
          ... on Biography {
            author
            title
            subject
          }
        }
      }
    `),
    variables: {
      type: params.type,
    },
  });

  return (
    <main>
      <h1 className="m-10 text-3xl font-bold">{params.type}</h1>
      {res.data.books.map((book) => {
        switch (book.__typename) {
          case "Novel":
            return <Novel key={book.title} {...book} />;
          case "Comic":
            return <Comic key={book.title} {...book} />;
          case "Biography":
            return <Biography key={book.title} {...book} />;
        }
      })}
    </main>
  );
}
```

ë†€ëê²Œë„ ì¿¼ë¦¬ë¥¼ ë‚ ë¦´ ë•Œ `variables`ì™€ ê·¸ ê²°ê³¼ì¸ `res.data` ê°€ íƒ€ì…ì´ ë¨¹í˜€ì ¸ ìˆìŠµë‹ˆë‹¤! ì´ ê¸°ê°€ ë§‰íŒâ€¦!

ì—¬ê¸°ì„œ ì£¼ëª©í•´ì•¼ í•  ê²ƒì€ gql í•¨ìˆ˜ì…ë‹ˆë‹¤. codegen ìœ¼ë¡œ ìƒì„±í•œ ì½”ë“œë¡œë¶€í„° ê°€ì ¸ì˜¨ í•¨ìˆ˜ì…ë‹ˆë‹¤. ``gql(/* GraphQL */ `ë‚´ìš©`);`` ê³¼ ê°™ì€ ì“°ì„ìƒˆì…ë‹ˆë‹¤. `GraphQL` ì£¼ì„ì´ ë¶™ì€ ì´ìœ ëŠ” IDE ì—ì„œ ì§€ì›í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤. ì´ gql í•¨ìˆ˜ë¥¼ ê±°ì¹˜ë©´ ë†€ëê²Œë„ íƒ€ì…ì´ ë‹¤ ë¨¹í˜€ìˆëŠ” ìƒíƒœë¡œ ë‚˜ì˜µë‹ˆë‹¤.

## ì‹¤ì œ íš¨ìš© ëŠê»´ë³´ê¸°

ì‹¤ì œ ì‘ì—…ê³¼ ìœ ì‚¬í•˜ê²Œ ì§„í–‰í•´ë³´ê² ìŠµë‹ˆë‹¤.

ì¼ë‹¨ ëª¨ë“  ê²ƒì˜ ì‹œì‘ì€ ìŠ¤í‚¤ë§ˆë¼ê³  í–ˆìŠµë‹ˆë‹¤. ìš°ë¦¬ëŠ” ìƒˆë¡œìš´ addNovel Mutation ì„ ì¶”ê°€í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```graphql api-server/src/schema.graphql
type Mutation {
  addNovel(title: String!, author: String!, genre: String!): Novel!
}
```

ê·¸ ë‹¤ìŒ `npm run codegen` ì„ ë•Œë¦½ë‹ˆë‹¤. ì˜¤â€¦ ë­”ê°€ Git Changes ì— ë­”ê°€ê°€ ì¡í™ë‹ˆë‹¤.

`git diff` ë¥¼ í•´ë³¼ê¹Œìš”?

```diff
diff --git a/api-server/src/generated/graphql.ts b/api-server/src/generated/graphql.ts
index 8f35129..d7730fc 100644
--- a/api-server/src/generated/graphql.ts
+++ b/api-server/src/generated/graphql.ts
@@ -19,6 +19,9 @@ export type Incremental<T> =
   | {
       [P in keyof T]?: P extends " $fragmentName" | "__typename" ? T[P] : never;
     };
+export type RequireFields<T, K extends keyof T> = Omit<T, K> & {
+  [P in K]-?: NonNullable<T[P]>;
+};
 /** All built-in and custom scalars, mapped to their actual values */
 export type Scalars = {
   ID: { input: string; output: string };
@@ -46,6 +49,17 @@ export type IComic = {
   title: Scalars["String"]["output"];
 };

+export type IMutation = {
+  __typename?: "Mutation";
+  addNovel: INovel;
+};
+
+export type IMutationAddNovelArgs = {
+  author: Scalars["String"]["input"];
+  genre: Scalars["String"]["input"];
+  title: Scalars["String"]["input"];
+};
+
 export type INovel = {
   __typename?: "Novel";
   author: Scalars["String"]["output"];
@@ -179,6 +193,7 @@ export type IResolversTypes = {
   BookType: IBookType;
   Boolean: ResolverTypeWrapper<Scalars["Boolean"]["output"]>;
   Comic: ResolverTypeWrapper<IComic>;
+  Mutation: ResolverTypeWrapper<{}>;
   Novel: ResolverTypeWrapper<INovel>;
   Query: ResolverTypeWrapper<{}>;
   String: ResolverTypeWrapper<Scalars["String"]["output"]>;
@@ -190,6 +205,7 @@ export type IResolversParentTypes = {
   Book: IResolversUnionTypes<IResolversParentTypes>["Book"];
   Boolean: Scalars["Boolean"]["output"];
   Comic: IComic;
+  Mutation: {};
   Novel: INovel;
   Query: {};
   String: Scalars["String"]["output"];
@@ -229,6 +245,19 @@ export type IComicResolvers<
   __isTypeOf?: IsTypeOfResolverFn<ParentType, ContextType>;
 };

+export type IMutationResolvers<
+  ContextType = any,
+  ParentType extends
+    IResolversParentTypes["Mutation"] = IResolversParentTypes["Mutation"],
+> = {
+  addNovel?: Resolver<
+    IResolversTypes["Novel"],
+    ParentType,
+    ContextType,
+    RequireFields<IMutationAddNovelArgs, "author" | "genre" | "title">
+  >;
+};
+
 export type INovelResolvers<
   ContextType = any,
   ParentType extends
@@ -257,6 +286,7 @@ export type IResolvers<ContextType = any> = {
   Biography?: IBiographyResolvers<ContextType>;
   Book?: IBookResolvers<ContextType>;
   Comic?: IComicResolvers<ContextType>;
+  Mutation?: IMutationResolvers<ContextType>;
   Novel?: INovelResolvers<ContextType>;
   Query?: IQueryResolvers<ContextType>;
 };
diff --git a/api-server/src/schema.graphql b/api-server/src/schema.graphql
index 1b7d9c8..2a07999 100644
--- a/api-server/src/schema.graphql
+++ b/api-server/src/schema.graphql
@@ -31,3 +31,7 @@ enum BookType {
 type Query {
   books: [Book!]!
 }
+
+type Mutation {
+  addNovel(title: String!, author: String!, genre: String!): Novel!
+}
diff --git a/web/generated/graphql/graphql.ts b/web/generated/graphql/graphql.ts
index affa61c..f8a2ef3 100644
--- a/web/generated/graphql/graphql.ts
+++ b/web/generated/graphql/graphql.ts
@@ -47,6 +47,17 @@ export type Comic = {
   title: Scalars["String"]["output"];
 };

+export type Mutation = {
+  __typename?: "Mutation";
+  addNovel: Novel;
+};
+
+export type MutationAddNovelArgs = {
+  author: Scalars["String"]["input"];
+  genre: Scalars["String"]["input"];
+  title: Scalars["String"]["input"];
+};
+
 export type Novel = {
   __typename?: "Novel";
   author: Scalars["String"]["output"];
```

ëª¬ê°€ ë§ì´ ìƒê²¼ë„¤ìš”â€¦

ì´ì œ ì•„ë˜ ì½”ë“œë¥¼ ì‘ì„±í•´ë³¼ê¹Œìš”?

```tsx api-server/src/index.ts
const resolvers: IResolvers = {
  Query: {
    // ì¤‘ëµ
  },
  Mutation: {
    addNovel: async (_parent, args) => {
      const { author, genre, title } = args;

      return {
        author,
        genre,
        title,
      };
    },
  },
};
```

ìë™ì™„ì„±ì´ ì•„ë¦„ë‹µê²Œ ë¨¹íˆëŠ” ê±¸ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<ArticleImage
  width={400}
  img={gifss}
  alt="ìë™ì™„ì„±ì´ ì˜ ë˜ëŠ” ëª¨ìŠµ"
  caption="ìë™ì™„ì„±ì´ ì˜ ë˜ëŠ” ëª¨ìŠµ. ì½”íŒŒì¼ëŸ¿ì´ ìê¾¸ ì¸í„°ì…‰íŠ¸ í•˜ì§€ë§Œ ê¿‹ê¿‹ì´ ë¬´ì‹œí•˜ê³  ì§„í–‰í•©ë‹ˆë‹¤."
/>

ì´ì œ í´ë¼ì´ì–¸íŠ¸ ìª½ì—ì„œ Mutation ìš”ì²­ ì¿¼ë¦¬ë¥¼ ë§Œë“¤ì–´ë³¼ê¹Œìš”? ì¼ë‹¨ ì•„ë˜ì™€ ê°™ì€ ì½”ë“œë¥¼ ì¶”ê°€í•´ë´…ì‹œë‹¤.

```tsx web/app/type/[type]/page.tsx
const res = await client.query({
  // ì¤‘ëµ
});

const addRes = await client.mutate({
  mutation: gql(/* GraphQL */ `
    mutation AddNovel($book: BookInput!) {
      addNovel(book: $book) {
        auther
      }
    }
  `),
});
```

ê·¸ ë‹¤ìŒ `npm run codegen` ì„ ì‹¤í–‰í•©ë‹ˆë‹¤. ìœ„ ì¿¼ë¦¬ëŠ” ì¼ë¶€ëŸ¬ ì¢€ ì´ìƒí•˜ê²Œ ì§°ìŠµë‹ˆë‹¤. ì´ì œ ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚ ê¹Œìš”?

```bash bash
# !mark(10:21) gold
> graphql-union@1.0.0 codegen
> graphql-codegen --config codegen.ts

âœ” Parse Configuration
âš  Generate outputs
  â¯ Generate to ./web/generated/graphql/
    âœ” Load GraphQL schemas
    âœ” Load GraphQL documents
    âœ– GraphQL Document Validation failed with 6 errors;
      Error 0: Unknown type "BookInput". Did you mean "BookType"?
      at /Users/th.kim/Desktop/graphql-union/web/app/type/[type]/page.tsx:2:32
      Error 1: Unknown argument "book" on field "Mutation.addNovel".
      at /Users/th.kim/Desktop/graphql-union/web/app/type/[type]/page.tsx:3:18
      Error 2: Cannot query field "auther" on type "Novel". Did you mean "author"?
      at /Users/th.kim/Desktop/graphql-union/web/app/type/[type]/page.tsx:4:11
      Error 3: Field "addNovel" argument "author" of type "String!" is required, but it wâ€¦
      at /Users/th.kim/Desktop/graphql-union/web/app/type/[type]/page.tsx:3:9
      Error 4: Field "addNovel" argument "genre" of type "String!" is required, but it waâ€¦
      at /Users/th.kim/Desktop/graphql-union/web/app/type/[type]/page.tsx:3:9
      Error 5: Field "addNovel" argument "title" of type "String!" is required, but it waâ€¦
      at /Users/th.kim/Desktop/graphql-union/web/app/type/[type]/page.tsx:3:9
  âœ” Generate to ./api-server/src/generated/graphql.ts
```

ì˜¤! ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

1. BookInput ì´ë¼ëŠ” íƒ€ì…ì„ ì°¾ì§€ ëª»í–ˆìŒ.
2. Mutation.addNovel ì—ëŠ” book ì¸ìê°€ ì—†ìŒ!
3. Novel íƒ€ì…ì—ëŠ” auth**e**r ì´ ì—†ìŒ. author ë¥¼ í•˜ë ¤ê³  í•œ ê²Œ ì•„ë‹Œì§€?
4. addNovel ì— author ì¸ìê°€ String! ì¸ë° ì°¾ì„ ìˆ˜ ì—†ìŒ!
5. addNovel ì— genre ì¸ìê°€ String! ì¸ë° ì°¾ì„ ìˆ˜ ì—†ìŒ!
6. addNovel ì— title ì¸ìê°€ String! ì¸ë° ì°¾ì„ ìˆ˜ ì—†ìŒ!

ì—ëŸ¬ë¥¼ ì¹œì ˆíˆ ì•Œë ¤ì¤ë‹ˆë‹¤. ì•„ë˜ ì½”ë“œë¡œ ê³ ì³ë³¼ê¹Œìš”?

```tsx
const addRes = await client.mutate({
  mutation: gql(/* GraphQL */ `
    mutation AddNovel($author: String!, $title: String!, $genre: String!) {
      addNovel(author: $author, title: $title, genre: $genre) {
        author
        title
        genre
      }
    }
  `),
});
```

ê·¸ ë‹¤ìŒ `npm run codegen` ë¥¼ ì‹¤í–‰í•´ë´…ì‹œë‹¤.

ì´ì œ ì½”ë“œë¥¼ ë‹¤ì‹œ í¸ì§‘í•´ë´…ì‹œë‹¤!

<ArticleImage
  width={400}
  img={o1}
  alt=""
  caption="variables ì—ì„œ ìë™ì™„ì„±ì´ ë˜ëŠ” ëª¨ìŠµ"
/>
<ArticleImage
  width={300}
  img={oo}
  alt=""
  caption="res.data ì—ì„œ ìë™ì™„ì„±ì´ ë˜ëŠ” ëª¨ìŠµ"
/>

íƒ€ì…ì´ ì œëŒ€ë¡œ ë˜ëŠ” ê²Œ ë³´ì…ë‹ˆë‹¤! ì•¼í˜¸. ì¼ë‹¨â€¦ ì‹¤ìŠµì€ ì—¬ê¸°ê¹Œì§€ ì§„í–‰í•©ì‹œë‹¤.

## GraphQL Union ìœ¼ë¡œ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì˜ Discriminated Union ì˜ ì´ì  ì·¨í•˜ê¸°

ì œê°€ Book ì„ êµ³ì´ union ìœ¼ë¡œ ì§€ì •í•œ ì´ìœ ê°€ ìˆì—ˆìŠµë‹ˆë‹¤. ì™œëƒí•˜ë©´ ì´ê±¸ ë³´ì—¬ì£¼ë ¤êµ¬ìš”â€¦ GraphQL ìŠ¤í‚¤ë§ˆì—ì„œ ìœ ë‹ˆì˜¨ìœ¼ë¡œ ì •ì˜ëœ Bookì˜ íƒ€ì…ì„ ì‚´í´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```tsx
export type Book = Biography | Comic | Novel;

export type BookType = "BIOGRAPHY" | "COMIC" | "NOVEL";

export type Biography = {
  __typename?: "Biography";
  author: Scalars["String"]["output"];
  subject: Scalars["String"]["output"];
  title: Scalars["String"]["output"];
};

export type Comic = {
  __typename?: "Comic";
  author: Scalars["String"]["output"];
  illustrator: Scalars["String"]["output"];
  title: Scalars["String"]["output"];
};

export type Novel = {
  __typename?: "Novel";
  author: Scalars["String"]["output"];
  genre: Scalars["String"]["output"];
  title: Scalars["String"]["output"];
};
```

ì´ëŠ” `__typename` í•„ë“œë¥¼ ê¸°ì¤€ìœ¼ë¡œ íƒ€ì…ì„ ì‰½ê²Œ ì •ë¦¬í•´ë³¼ ìˆ˜ ìˆë‹¨ ëœ»ì´ì£ . ìì„¸í•œ ë‚´ìš©ì€ [íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì—ì„œ Narrowing (íƒ€ì… ì¢íˆê¸°)](/article/2023-07/why-need-narrowing)ê°€ í•„ìš”í•œ ì´ìœ ë¥¼ ì°¸ì¡°í•´ì£¼ì„¸ìš”.

## âŒ í…œí”Œë¦¿ ë¦¬í„°ëŸ´ì€ í•˜ì§€ ë§™ì‹œë‹¤.

ì •í™•íˆëŠ” [í…œí”Œë¦¿ ë¦¬í„°ëŸ´](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals)ì€ ì¨ë„ ë˜ëŠ”ë°, ê·¸ ì•ˆì—ì„œ ì¹˜í™˜ `${...}` ì„ ì“°ì§€ ë§ìëŠ” ëœ»ì…ë‹ˆë‹¤. ì™œëƒí•˜ë©´ ì´ë ‡ê²Œ ì¹˜í™˜í•´ë²„ë ¸ì„ ë•Œ codegen í”„ë¡œê·¸ë¨ì´ í•„ìš”í•œ ì •ë³´ë¥¼ ì•Œ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì™œ ì•Œ ìˆ˜ ì—†ëƒêµ¬ìš”?

codegen ì€ ì‹¤ì œ ìë°”ìŠ¤í¬ë¦½íŠ¸ë‚˜ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ëŒì•„ê°€ëŠ” ë°©ì‹ì„ ìœ ì¶”í•´ ë³´ê±´ëŒ€, êµ¬ë¬¸ í•´ì„ê¸°ì— ì˜í•´ êµ¬ë¬¸ íŠ¸ë¦¬ê°€ ë§Œë“¤ì–´ì§ˆ ê²ƒì…ë‹ˆë‹¤. êµ¬ë¬¸ í•´ì„ê¸°ëŠ” ë§ ê·¸ëŒ€ë¡œ êµ¬ë¬¸ë§Œ í•´ì„í•˜ê¸° ë•Œë¬¸ì— `GET_USER` ì—ì„œëŠ” `queryName` ì´ë¼ëŠ” ì´ë¦„(name)ì„ ì°¸ì¡°í•˜ê³  ìˆë‹¤ëŠ” ì‚¬ì‹¤ë§Œ ì•Œ ë¿, ì—¬ê¸°ì— `"getUser"`ì´ë¼ëŠ” ê°’ì´ ìˆëŠ”ì§€ ì—†ëŠ”ì§€ ì´ëŸ° íŒë‹¨ ìì²´ë¥¼ ë‚´ë¦´ ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.

```tsx
const queryName = "getUser";
const GET_USER = gql`
  query GetUser($id: ID!) {
    ${queryName}(id: $id) {
      id
      name
      email
      age
    }
  }
`;
```

ìœ„ì™€ ê°™ì´ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ê³  `npm run codegen` ì„ í•´ë³¸ë‹¤ë©´ ê²°ê³¼ê°€ ì¢€ ì´ìƒí•  ê²ƒì…ë‹ˆë‹¤.

## ê²°ë¡ 

codegen ì„ ì“°ê¸° ìœ„í•´ì„œëŠ” `codegen.ts` íŒŒì¼ì„ ì‘ì„±í•˜ëŠ” ë°©ë²•, ì–´ë–¤ í”ŒëŸ¬ê·¸ì¸ì´ ìˆëŠ”ì§€, ì–´ë–¤ í”„ë¦¬ì…‹ì´ ìˆëŠ”ì§€, ì˜µì…˜ì´ ì–´ë–¤ ê²Œ ìˆëŠ”ì§€ ë“±ë“± ì•„ì£¼ ìì„¸í•˜ê²Œ íŒŒì•…í•´ì•¼ ì˜ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ì˜ ì“°ê¸°ê°€ ê¹Œë‹¤ë¡­ìŠµë‹ˆë‹¤.

ì•ˆì •ì„±ë„ ë†’ì§€ëŠ” ì•Šì€ ê¸°ë¶„ì…ë‹ˆë‹¤. npm ë‹¤ìš´ë¡œë“œ ìˆ˜ê°€ ê·¸ë ‡ê²Œ ë†’ì§„ ì•ŠìŠµë‹ˆë‹¤. ê¸ˆë°© deprecated ë˜ëŠ” ê²ƒë“¤ë„ ì¢€ ë§ì•„ ë³´ì´êµ¬ìš”.

**íƒ€ì…ì„ ì¼ì¼íˆ ì§€ì •í•´ì•¼ í•˜ëŠ” íë‹¨ë§Œí¼ì€ í”¼í•˜ê¸° ìœ„í•´** ìš¸ë©° ê²¨ìë¨¹ê¸°ë¡œ ì½”ë“œì  ì„ ë„ì…í•œë‹¤ê³  ë³¼ ìˆ˜ ìˆì£ . GraphQL ê³¼ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ê°€ ì•„ì˜ˆ ë‹¤ë¥¸ ì˜ì—­ì—ì„œ í•œê°€ë‹¥ í•˜ëŠ” ë…€ì„ë“¤ì¸ ë§Œí¼ í•­ìƒ í˜„ì‹¤ê³¼ íƒ€í˜‘í•´ì•¼ í•˜ëŠ” ê¸°ë¶„ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ë¶„ë“¤ì€ ì–´ë–»ê²Œ í˜„ì‹¤ê³¼ íƒ€í˜‘í•˜ê³  ê³„ì‹œëŠ”ì§€ ê¶ê¸ˆí•˜ë„¤ìš”! ê°ì‚¬í•©ë‹ˆë‹¤.

## ì°¸ì¡°

- [TypeScript with GraphQL done right (charly poly)](https://charlypoly.com/publications/typescript-with-graphql-done-right)
- [Generating types from a GraphQL schema (Apollo Server)](https://www.apollographql.com/docs/apollo-server/workflow/generate-types/)
- [Generating types (Apollo Tutorial)](https://www.apollographql.com/tutorials/lift-off-part1/09-codegen)
- [GraphQL -> Typescript Codegen (Hasura)](https://hasura.io/learn/graphql/typescript-react-apollo/codegen/)
