import ArticleHeader from "@modules/article/ArticleHeader";
import ArticleImage from "@modules/article/ArticleImage";
import getArticleHeaderProps from "@modules/metadata/getArticleHeaderProps";
import getArticleJsonLdProps from "@modules/metadata/getArticleJsonLdProps";
import getArticleMetadata from "@modules/metadata/getArticleMetadata";
import { ArticleJsonLd } from "next-seo";
import { item } from "./metadata";
import i1 from "./inject.png";
import p1 from "./p1.png";
import p2 from "./p2.png";

export const metadata = getArticleMetadata(item);

<ArticleJsonLd {...getArticleJsonLdProps(item)} />

<ArticleHeader {...getArticleHeaderProps(item)} />

<ArticleImage img={i1} border alt="" caption={<>ì¼ëŸ¬ìŠ¤íŠ¸ by ChatGPT</>} />

## ëª©ì°¨

## ìš”ì•½

- í™˜ê²½ë³€ìˆ˜ë¡œ Next.js ì•±ì˜ ë™ì‘ì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤. ê·¸ ì¤‘ `NEXT_PUBLIC_XXX` ëŠ” ë¹Œë“œ ì‹œì ì— ê²°ì •ë˜ëŠ” í™˜ê²½ë³€ìˆ˜ë‹¤.
- `NEXT_PUBLIC_XXX`ê°€ ê¼­ í•„ìš”í•œ ìƒí™©ì€ ê·¸ë¦¬ ë§ì§€ ì•Šë‹¤. ê·¸ëŸ¬ë‹ˆ ì‚¬ìš©í•˜ì§€ ë§ì.
- ë¸Œë¼ìš°ì €ì—ì„œ í•„ìš”í•œ ë°ì´í„°ëŠ” ì§ì ‘ ì£¼ì…í•˜ì. (ê°€ì¥ ë¹ ë¥´ê²Œ ë¡œë”©ë˜ëŠ” `env.js` íŒŒì¼)

## í™˜ê²½ë³€ìˆ˜ì™€ Next.js

í™˜ê²½ë³€ìˆ˜(Environment Variables)ë€ ë¬´ì—‡ì¼ê¹Œìš”? ê°„ë‹¨í•˜ê²Œ ë§í•˜ë©´ í”„ë¡œê·¸ë¨(í”„ë¡œì„¸ìŠ¤)ì´ ì‹œì‘í•˜ëŠ” ì‹œì ì— ì½ì„ ìˆ˜ ìˆëŠ” ìš´ì˜ì²´ì œ ì°¨ì›ì˜ ì „ì—­ ë³€ìˆ˜ì…ë‹ˆë‹¤. ë³´í†µ ìš°ë¦¬ê°€ ì›í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•˜ë ¤ë©´ ì¸ìê°’(Arguments)ì´ë‚˜ ì˜µì…˜ ë“±ì„ ì ì ˆíˆ ì¤ë‹ˆë‹¤(`ls` vs `ls -al` ì²˜ëŸ¼). í™˜ê²½ë³€ìˆ˜ë¡œë„ í•  ìˆ˜ ìˆëŠ” ê²ƒë“¤ì´ ë§ìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ `TZ=America/New_York ls -al` ë¡œ í•œë‹¤ë©´ ë‰´ìš• ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ ì‹œê°„ì´ ë‚˜ì˜µë‹ˆë‹¤. í™˜ê²½ë³€ìˆ˜ëŠ” ëª…ë ¹ì–´ë‚˜ í”„ë¡œê·¸ë¨ì´ ì‹œì‘í•˜ê¸° ì „ì´ë¼ë©´ ì–¸ì œë“ ì§€ **ë¯¸ë¦¬** ì„¤ì •í•  ìˆ˜ ìˆì§€ë§Œ í”„ë¡œê·¸ë¨ì´ ì¼ë‹¨ ì‹œì‘í•˜ë©´ í™˜ê²½ë³€ìˆ˜ë¥¼ ìˆ˜ì •í•˜ëŠ” ê±´ ì˜ë¯¸ê°€ ì—†ìŠµë‹ˆë‹¤.

ê·¸ë ‡ë‹¤ë©´ ì›¹ì„œë¹„ìŠ¤ì™€ í™˜ê²½ë³€ìˆ˜ì˜ ê´€ê³„ëŠ” ì–´ë–»ê²Œ ë ê¹Œìš”? ì „í†µì ì¸ ì›¹ì€ HTML, CSS, JavaScript íŒŒì¼ë§Œ ì˜ ì „ë‹¬í•´ì£¼ë©´ ëìŠµë‹ˆë‹¤. ì‚¬ì´íŠ¸ì˜ ë™ì‘ì„ ë°”ê¾¸ë ¤ë©´ ì´ íŒŒì¼ì„ ìˆ˜ì •í•´ì„œ ìƒˆë¡œ ì—…ë¡œë“œí•˜ë©´ ëê³  í™˜ê²½ë³€ìˆ˜ì™€ëŠ” í° ì—°ê´€ì´ ì—†ì—ˆìŠµë‹ˆë‹¤. Reactë„ 3ê°œ ì¢…ë¥˜ì˜ íŒŒì¼ì„ ìƒì„±(**ë¹Œë“œ**)í•˜ê³  ì–´ë”˜ê°€ì— ì—…ë¡œë“œí•˜ëŠ” ì‹ìœ¼ë¡œ ë°°í¬ê°€ ì§„í–‰ë©ë‹ˆë‹¤. ë‹¤ë§Œ ê°œë°œí•  ë•Œì™€ ì‹¤ì œ ë°°í¬ í™˜ê²½ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê°’ë“¤ì´ ë‹¬ë¼(ì˜ˆ: API ì„œë²„ ì£¼ì†Œ) ë¹Œë“œ ì‹œì ì— ì ì ˆí•œ ê°’ìœ¼ë¡œ íŒŒì¼ë“¤ì´ ìƒì„±ë˜ì–´ì•¼ í–ˆê³ , ì´ ë•Œ í™˜ê²½ë³€ìˆ˜ê°€ ì‚¬ìš©ë˜ëŠ” ê±°ì£ .

[CRA(Create React App)](https://create-react-app.dev/)ì— ìˆë˜ webpackì€ ì˜¨ê°– ì¡ë‹¤êµ¬ë¦¬í•œ ê²ƒë“¤ì„ ì˜ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì†ŒìŠ¤ì½”ë“œì—ì„œ `process.env.REACT_APP_XXX` í† í°ì„ ì°¾ì•„ ë¹Œë“œ ì‹œì ì— ê³ ì •ëœ ê°’ìœ¼ë¡œ ì¹˜í™˜í•˜ëŠ” ê±´ ì¼ë„ ì•„ë‹ˆì—ˆì£ . **ë¹Œë“œ ì‹œì ì— í™˜ê²½ë³€ìˆ˜ë¥¼ ë‹¤ë¥´ê²Œ ì„¤ì •**í•˜ì—¬ ê²°ê³¼ë¬¼ì„ ì ì ˆí•˜ê²Œ ë§Œë“¤ì–´ë‚´ëŠ” ë°©ì‹ì´ í”í•´ì¡ŒìŠµë‹ˆë‹¤. Next.jsì—ëŠ” ê°™ì€ ë°©ì‹ìœ¼ë¡œ ë™ì‘í•˜ëŠ” `NEXT_PUBLIC_` ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” íŠ¹ìˆ˜í•œ í™˜ê²½ë³€ìˆ˜ ê¸°ëŠ¥ì´ [2020ë…„ 5ì›”, Next.js `9.4` ë²„ì „](https://nextjs.org/blog/next-9-4#new-environment-variables-support)ì— ë¦´ë¦¬ì¦ˆ ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ ê¸°ëŠ¥ì„ ì†Œê°œí•˜ë©´ì„œ fully backward-compatible features ë¼ê³  í•˜ëŠ” ê±¸ë¡œ ë³´ì•„ CRA ì‹œì ˆë¶€í„° ìˆì—ˆë˜ ê¸°ëŠ¥ì„ ì˜ ì§€ì›í•´ì¤€ë‹¤ëŠ” ëŠë‚Œì¸ ê²ƒ ê°™ì•„ìš”.

- ì“¸ë°ì—†ëŠ” ì§€ì‹: ì‚¬ì‹¤ `5.1` ë²„ì „ì—ì„œë¶€í„° ì¼ì°Œê°ì¹˜ [Runtime Config](https://nextjs.org/blog/next-5-1#environment-configuration)ë¼ëŠ” ê¸°ëŠ¥ìœ¼ë¡œ configurationì„ í†µí•©í•˜ë ¤ëŠ” ì‹œë„ê°€ ìˆì—ˆì§€ë§Œ ê²°êµ­ deprecated ë˜ì—ˆìŠµë‹ˆë‹¤. í™˜ê²½ë³€ìˆ˜ë€ê²Œ ì›Œë‚™ì— ê°œë°œì ì‚¬ì´ì—ì„œ ìµìˆ™í•´ì„œ ì˜€ì„ê¹Œìš”?

ê·¸ëŸ°ë° Next.jsì™€ ê°„ë‹¨í•œ React ì•±ì€ ë‹¤ë¦…ë‹ˆë‹¤. Reactì—ëŠ” ì„œë²„ë€ ì—†ìŠµë‹ˆë‹¤. ë‹¨ì§€ ì •ì  íŒŒì¼ì„ ì˜ ìƒì„±í•´ì£¼ëŠ” ì—­í• ì„ ì—´ì‹¬íˆ í•  ë¿ì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ Next.jsëŠ” Node.js ê¸°ë°˜ìœ¼ë¡œ ëŒì•„ê°€ëŠ” ì„œë²„ì…ë‹ˆë‹¤. ì„œë²„ëŠ” ì‹¤í–‰ ì‹œì‘! ì¢…ë£Œ! í•˜ëŠ” í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤. ì„œë²„ë„ í™˜ê²½ë³€ìˆ˜ë¥¼ ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ì œ í—·ê°ˆë¦½ë‹ˆë‹¤. ë¹Œë“œ ì‹œì ì— ì¹˜í™˜ë˜ëŠ” í™˜ê²½ë³€ìˆ˜ì™€ ì„œë²„ ì‹¤í–‰ ì‹œì ì— ì½ì–´ë“¤ì´ëŠ” ëŸ°íƒ€ì„ í™˜ê²½ë³€ìˆ˜ ë‘ ê°€ì§€ë¥¼ ìƒê°í•´ì•¼ í•©ë‹ˆë‹¤.

## ë¶ˆí¸í•œ ì ì´ í•œë‘ ê°€ì§€ê°€ ì•„ë‹ˆë‹¤!

ë¹Œë“œ ì‹œì ì— ê²°ì •ë˜ëŠ” `NEXT_PUBLIC_` ê³„ì—´ì˜ í™˜ê²½ë³€ìˆ˜ëŠ” ì—¬ëŸ¬ëª¨ë¡œ ë¶ˆí¸í•œë°ìš”,

- í™˜ê²½ë³€ìˆ˜ë¥¼ ìˆ˜ì •í•˜ë ¤ë©´ ë¹Œë“œë¥¼ ìƒˆë¡œ í•´ì•¼ í•©ë‹ˆë‹¤. ë¹Œë“œëŠ” ì˜¤ë˜ ê±¸ë¦½ë‹ˆë‹¤.
- ë°°í¬ í™˜ê²½ì— ë”°ë¼ ì´ í™˜ê²½ë³€ìˆ˜ê°€ ë‹¬ë¼ì§„ë‹¤ë©´ ë°°í¬ í™˜ê²½ë§ˆë‹¤ ë‹¤ë¥´ê²Œ ë¹Œë“œí•´ì•¼ í•©ë‹ˆë‹¤.
- Docker ì´ë¯¸ì§€ë¡œ ë¹Œë“œë³¸ì„ ê´€ë¦¬í•˜ê³  ìˆë‹¤ë©´ ê·¸ë§Œí¼ ì´ë¯¸ì§€ì˜ ê°œìˆ˜ë„ ë§ì•„ì§‘ë‹ˆë‹¤.
- ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ëŠ” jobë„ nê°œê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì´ í™˜ê²½ë³€ìˆ˜ë¥¼ ëŸ°íƒ€ì„ì— ì„¸íŒ…í•  í•„ìš”ê°€ ì—†ë‹¤ëŠ” ì‚¬ì‹¤ì„ ê³§ë°”ë¡œ ì¸ì§€í•˜ê¸° í˜ë“­ë‹ˆë‹¤. (í™˜ê²½ë³€ìˆ˜ë¼ëŠ” ìš©ì–´ë¥¼ ì“°ì§€ ë§ì•„ì•¼ í•œë‹¤ëŠ” ìƒê°ë„ ë“­ë‹ˆë‹¤)

## í™˜ê²½ë³€ìˆ˜ë¥¼ ë¼ì›Œë„£ì„ ìˆ˜ ìˆë‹¤ëŠ” í¬ë§

ì €ëŠ” ê·¸ëŸ° ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤. ì–´ì°¨í”¼ ìš°ë¦¬ì˜ Next.js ì„œë²„ëŠ” `HTML` íŒŒì¼ì„ ë§Œë“¤ì–´ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œ ì „ë‹¬í•  ìš´ëª…ì¼ í…ë°, ê±°ê¸°ì— ë‚´ê°€ ì›í•˜ëŠ” í™˜ê²½ ë³€ìˆ˜ë§Œ ì–´ë–»ê²Œë“  **ë¼ì›Œë„£ì„** ìˆ˜ ìˆë‹¤ë©´, `NEXT_PUBLIC_` í™˜ê²½ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  í•„ìš”ëŠ” ì—†ì§€ ì•Šì„ê¹Œ?

ê·¸ë˜ì„œ ì´ í™˜ê²½ë³€ìˆ˜ê°€ ê°€ì¥ í”í•˜ê²Œ ì‚¬ìš©ë˜ëŠ” ì‚¬ë¡€ë¥¼ ìƒê°í•´ë´¤ìŠµë‹ˆë‹¤.

- GA4, Sentry, Meta Pixel, Sentry ë“± ë¸Œë¼ìš°ì €ì—ì„œ ë™ì‘í•˜ëŠ” SDK ì´ˆê¸°í™”ì— í•„ìš”í•œ ê°’
- API Endpoint
- ì†Œì…œ ë¡œê·¸ì¸ ê´€ë ¨ Client ID (íŠ¹íˆ redirct url ë§Œë“¤ ë•Œ)
- í”¼ì³ í”Œë˜ê·¸
- SSG í˜ì´ì§€ ë§Œë“¤ ë•Œ

ê°ê°ì€ ë¼ì›Œë„£ê¸°ë¡œ ì–´ì§€ê°„í•´ì„  í•´ê²°ì´ ë  ê²ƒ ê°™ê³ , í”¼ì³í”Œë˜ê·¸ ê°™ì€ ê²½ìš° ë‹¤ì‹œ ë¹Œë“œí•˜ëŠ” ê²ƒë³´ë‹¤ í™˜ê²½ë³€ìˆ˜ ë°”ê¿”ì„œ ì¬ì‹œì‘í•˜ëŠ” ê²Œ í›¨ì”¬ ìš´ì˜ì— ë¶€ë‹´ì´ ì—†ì„ ê²ƒ ê°™ì•„ìš”.

SSG í˜ì´ì§€ëŠ” ë¹Œë“œ ì‹œì ì— ë­”ê°€ ê²°ì •í•˜ë ¤ê³  í•œë‹¤ëŠ” ëœ»ì´ê¸° ë•Œë¬¸ì— `NEXT_PUBLIC_` í•¨ìˆ˜ë¥¼ ì ê·¹ì ìœ¼ë¡œ ì“°ëŠ”ê²Œ ì–´ìƒ‰í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ë¹ ë¥¸ í˜ì´ì§€ ë¡œë”© ë“±ì˜ ì´ë“ì„ ë³´ê¸° ìœ„í•œ ê±°ë¼ ëª©ì ë„ ëšœë ·í•©ë‹ˆë‹¤. ëŸ°íƒ€ì„ ë•Œ í–‰ë™ì„ ë‹¤ì–‘í•˜ê²Œ ë°”ê¾¸ê² ë‹¤ë¼ëŠ” ëª©ì ê³¼ ëª¨ìˆœë©ë‹ˆë‹¤. ì„œë²„ë¥¼ ì‹œì‘í•  ë•Œ ìƒì„±ë˜ëŠ” ì •ì  í˜ì´ì§€(ì¼ì¢…ì˜ ISR)ë¥¼ ìƒìƒí•´ë³¼ ìˆ˜ë„ ìˆê² ì§€ë§Œ, ìŒ, ê·¸ê±´ ì¢€ íŠ¹ì´í•œ ì¼€ì´ìŠ¤ì¼ ê±° ê°™ì•„ì„œ ì´ ê¸€ì—ì„œëŠ” ë‹¤ë£¨ì§€ ì•Šê² ìŠµë‹ˆë‹¤.

ë¼ì›Œë„£ê¸°ë¥¼ í–ˆë‹¤ ì¹©ì‹œë‹¤. ê·¸ëŸ°ë° SSRì—ì„œë„ ì§€ì›ë˜ì–´ì•¼ í•˜ì§€ ì•Šëƒê³ ìš”? ë˜í•‘ í•¨ìˆ˜ë¥¼ ë§Œë“¤ë©´ ë˜ì§€ ì•Šì„ê¹Œìš”?

```ts lib/config.ts
export const getAPIEndpoint = () =>
  typeof window === "undefined"
    ? process.env.API_ENDPOINT
    : window.API_ENDPOINT; // ì–´ë””ì„ ê°€ ë¼ì›Œë„£ì–´ì¡Œë‹¤ê³  ê°€ì •
```

ì œ ê²°ë¡ ì€ **ë¼ì›Œë„£ê¸°ê°€ ê°€ëŠ¥í•˜ë‹¤ë©´ `NEXT_PUBLIC_` í™˜ê²½ë³€ìˆ˜ë¥¼ ë‘˜ ì´ìœ ëŠ” ì—†ë‹¤**ì…ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì‹¤ì œë¡œ ë¼ì›Œë„£ê¸°ë¥¼ í•´ë³¸ ê²°ê³¼ ìµœì‹  Next.js 15ì—ì„œë„ ì˜ ë˜ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤. Pages, App Router ìƒê´€ì—†ì´ìš”!

## ë¼ì›Œë„£ê¸° Next.js 15 Pages Router

ìš°ì„  ì†ŒìŠ¤ì½”ë“œ. https://github.com/echoja/inject-env-nextjs-pages-router
ì‹¤ìŠµì—ì„œëŠ” `API_ENDPOINT` í™˜ê²½ë³€ìˆ˜ë¥¼ ë‹¤ë¥´ê²Œ ë„£ì–´ì£¼ëŠ” ê±¸ë¡œ í•˜ê² ìŠµë‹ˆë‹¤.

`_document.tsx` íŒŒì¼ì—ì„œ í™˜ê²½ë³€ìˆ˜ë¥¼ ë„£ì–´ì¤ì‹œë‹¤. [ë¬¸ì„œì— ë”°ë¥´ë©´ ì´ íŒŒì¼ì€ ì„œë²„ì—ì„œë§Œ ë Œë”ë§](https://nextjs.org/docs/pages/building-your-application/routing/custom-document)ëœë‹¤ê³  í•©ë‹ˆë‹¤. ì¦‰ `process.env`ì—ë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤ëŠ” ì´ì•¼ê¸°ì§€ìš”. `script` íƒœê·¸ì— `dangerouslySetInnerHTML`ë¡œ ì§ì ‘ ë„£ì–´ì£¼ë©´ ë  ê²ƒ ê°™ì§€ë§Œ ë¹Œë“œ íƒ€ì„ì— ì¹˜í™˜ë˜ëŠ” ê²ƒ ê°™ë”ë¼êµ¬ìš”. ê·¸ë˜ì„œ **`env.js`ë¼ëŠ” íŒŒì¼ì„ ì„œë²„ ì‹œì‘ ì‹œì ì— ë§Œë“¤ì–´ì„œ `public` í´ë”ì— ë„£ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.**

ì¼ë‹¨ `env.js` íŒŒì¼ì„ ì¦‰ì‹œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë„ë¡ `_document.tsx` íŒŒì¼ì„ ìˆ˜ì •í•´ì¤ë‹ˆë‹¤.

```tsx pages/_document.tsx
import { Html, Head, Main, NextScript } from "next/document";

export default function Document() {
  return (
    <Html lang="en">
      <Head>
        {/* !mark(1) */}
        <script src="/env.js" />
      </Head>
      <body>
        <Main />
        <NextScript />
      </body>
    </Html>
  );
}
```

`env.js` íŒŒì¼ì€ ë‹¤ë¥¸ íŒŒì¼ë³´ë‹¤ ë¨¼ì € ë¡œë”©ë˜ì–´ì•¼ í•˜ë¯€ë¡œ **`async`ë‚˜ `defer`ë¥¼ ë¶™ì—¬ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤.**

ì´ì œ Next.js ì•±ì´ ì‹œì‘í•  ë•Œ `env.js` íŒŒì¼ì´ ìƒì„±ë  ìˆ˜ ìˆë„ë¡ ì½”ë“œë¥¼ ì§œì¤ë‹ˆë‹¤. `next.config.ts` íŒŒì¼ì„ ìˆ˜ì •í•´ì¤ë‹ˆë‹¤.

```ts next.config.ts
import type { NextConfig } from "next";

// !mark(1:11)
import { getAPIEndpoint } from "./lib/config";
import { writeFileSync } from "node:fs";
import { join } from "node:path";

const envFilePath = join(process.cwd(), "public", "env.js");
writeFileSync(
  envFilePath,
  `window.API_ENDPOINT = "${getAPIEndpoint()}";\n`,
  "utf8",
);
console.log("Environment file created at:", envFilePath);

const nextConfig: NextConfig = {
  /* config options here */
  reactStrictMode: true,
};

export default nextConfig;
```

`env.js` íŒŒì¼ì˜ ë‚´ìš©ì€ `window.API_ENDPOINT = "${getAPIEndpoint()}";\n` ì´ê²Œ ëì…ë‹ˆë‹¤. `NEXT_PUBLIC_` ì—¬ë¶€ë¥¼ ë– ë‚˜ì„œ ìš°ë¦¬ê°€ ì›í•˜ëŠ” í™˜ê²½ë³€ìˆ˜ë¥¼ ë¸Œë¼ìš°ì €ì—ì„œ ë°”ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ `window`ì— ì „ì—­ë³€ìˆ˜ë¡œ ë„£ì–´ì¤ë‹ˆë‹¤.

ì„œë²„ ì‹œì‘ ì „ ë¬´ì¡°ê±´ `next.config.ts` íŒŒì¼ì„ ì½ê¸° ë•Œë¬¸ì— ì—¬ê¸°ì— `env.js` íŒŒì¼ ìƒì„± ì½”ë“œë¥¼ ì¼ëŠ”ë°ìš”, ë§¤ë„ëŸ¬ìš´ ì½”ë“œëŠ” ì•„ë‹™ë‹ˆë‹¤. `next start` ë¥¼ í•˜ê¸° ì§ì „ì— ë‹¤ë¥¸ ìŠ¤í¬ë¦½íŠ¸ë¡œ êµ¬í˜„í•´ë„ ê´œì°®ìŠµë‹ˆë‹¤. ì € `public` í´ë” ì•ˆì— ìˆëŠ” ë‹¤ì–‘í•œ ì—ì…‹ íŒŒì¼ì€ ë³´í†µ ë¹Œë“œ ê³¼ì •ì— ì±„ìœ„ì§€ê¸´ í•˜ì§€ë§Œ ê¼­ ê·¸ë•Œì—ë§Œ ì±„ì›Œì§ˆ í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤.

ìœ„ ì½”ë“œë¥¼ Docker í™˜ê²½ì—ì„œ ì˜ ì‹¤í–‰ë˜ë„ë¡ í•˜ë ¤ë©´ Docker Image ì•ˆì— `config.ts` íŒŒì¼ë„ ìµœì¢…ì ìœ¼ë¡œ í¬í•¨ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. í¬í•¨ë˜ì–´ ìˆì§€ ì•Šìœ¼ë©´ `next.config.ts` íŒŒì¼ì„ ì½ì„ ë•Œ `config` íŒŒì¼ ì—†ë‹¤ê³  ì—ëŸ¬ê°€ ëœ¹ë‹ˆë‹¤.

```dockerfile Dockerfile
# ë¹Œë“œëœ ê²°ê³¼ë¬¼ë§Œ ë³µì‚¬
COPY --from=builder /app/public ./public
COPY --from=builder /app/.next ./.next
COPY --from=builder /app/node_modules ./node_modules
COPY --from=builder /app/package.json ./package.json
COPY --from=builder /app/next.config.ts ./next.config.ts
# !mark(1)
COPY --from=builder /app/lib/config.ts ./lib/config.ts

EXPOSE 3000
CMD ["npm", "start"]
```

ì˜ˆì œ ì»´í¬ë„ŒíŠ¸ë¥¼ ë§Œë“¤ì–´ë´¤ìŠµë‹ˆë‹¤.

```tsx components/Todo.tsx
"use client";

import { getAPIEndpoint } from "@/lib/config";
import useSWR from "swr";

const fetcher = (...args: Parameters<typeof fetch>) =>
  fetch(...args).then((res) => res.json());

export function Todo({ id }: { id: string }) {
  const { data, error, isLoading } = useSWR(
    // !mark(1)
    `${getAPIEndpoint()}/todos/${id}`,
    fetcher,
  );

  if (error) {
    return <div>failed to load</div>;
  }
  if (isLoading) {
    return <div>loading...</div>;
  }

  return <div>title: {data.title ?? "NO_DATA"}</div>;
}
```

`getAPIEndpoint()` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ì„œ API ê²½ë¡œë¥¼ ê°€ì ¸ì˜¤ëŠ” ê±¸ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ì œ ë¹Œë“œ í›„ ì‹¤í–‰í•´ë´…ì‹œë‹¤. Next.jsì—ì„œëŠ” ê°œë°œ ì„œë²„ì™€ production ë¹Œë“œ ì„œë²„ ì‚¬ì´ì˜ ë™ì‘ì´ ë‹¤ë¥¸ ê²½ìš°ê°€ ìˆìœ¼ë¯€ë¡œ í™•ì‹¤íˆ í™•ì¸í•˜ê¸° ìœ„í•´ì„œëŠ” `npm run build` ë° `npm run start`ë¥¼ í•˜ë„ë¡ í•©ë‹ˆë‹¤.

```sh
npm run build
API_ENDPOINT=https://jsonplaceholder.typicode.com npm run start
```

ì‹¤í–‰í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ì¶œë ¥ë˜ëŠ” ê±¸ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```txt
> inject-env-page-router@0.1.0 start
> next start

   â–² Next.js 15.4.2
   - Local:        http://localhost:3000
   - Network:      http://192.168.45.73:3000

 âœ“ Starting...
Environment file created at: /Users/th.kim/Desktop/inject-env-nextjs-pages-router/public/env.js
Environment file created at: /Users/th.kim/Desktop/inject-env-nextjs-pages-router/public/env.js
 âœ“ Ready in 359ms
```

ì‹¤ì œ ë™ì‘ì„ í™•ì¸í•´ë³¼ê¹Œìš”?

<ArticleImage
  img={p2}
  border
  alt=""
  caption={
    <>
      ë¸Œë¼ìš°ì €ì—ì„œ <code>API_ENDPOINT</code> í™˜ê²½ë³€ìˆ˜ë¥¼ ì˜ ê°€ì ¸ë‹¤ ì“°ê³  ìˆëŠ” ëª¨ìŠµ
    </>
  }
/>

í›Œë¥­í•©ë‹ˆë‹¤. ì´ë¡œì¨ ìš°ë¦¬ëŠ” í•˜ë‚˜ë¡œ ë¹Œë“œ í•´ë†“ê³  í™˜ê²½ë³€ìˆ˜ë¥¼ ë‹¤ì–‘í•˜ê²Œ ì¤˜ì„œ ë¸Œë¼ìš°ì €ìª½ í–‰ë™ë„ ë‹¤ë¥´ê²Œ í•  ìˆ˜ ìˆìŒì„ ë³´ì˜€ìŠµë‹ˆë‹¤.

ì´ì œ dockerì—ì„œë„ ì˜ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•´ë³¼ê¹Œìš”?

```sh
docker build --force-rm=true -t inject-env .
docker run -p 3000:3000 --rm -it -e API_ENDPOINT=https://jsonplaceholder.typicode.com inject-env
```

ë¡œì»¬ ë¹Œë“œ + ì‹¤í–‰ê³¼ ë˜‘ê°™ì´ ì˜ ëœë‹¤ëŠ” ê±¸ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!

## ë¼ì›Œë„£ê¸° Next.js 15 App Router

ì†ŒìŠ¤ì½”ë“œ: https://github.com/echoja/inject-env-nextjs-app-router

Pages Routerì™€ íë¦„ì€ ë˜‘ê°™ìŠµë‹ˆë‹¤. ì‹œì‘í•  ë•Œë§ˆë‹¤ `env.js` íŒŒì¼ì„ ë§Œë“¤ì–´ì£¼ê³ , ì´ íŒŒì¼ì„ ê°€ì¥ ë¨¼ì € ë¡œë”©í•˜ë„ë¡ ê³µí†µ ë ˆì´ì•„ì›ƒ ì½”ë“œë¥¼ ìˆ˜ì •í•´ì¤ë‹ˆë‹¤. App Routerì—ì„œëŠ” ìµœìƒìœ„ì˜ layout.tsx íŒŒì¼ì…ë‹ˆë‹¤. App RouterëŠ” Pagesì™€ ë‹¬ë¦¬ `env.js`ê°€ `head`ì˜ ë’·ë¶€ë¶„ì— ìˆì–´ì„œ ì•½ê°„ ë¶ˆì•ˆí•œ ëŠë‚Œì€ ìˆìŠµë‹ˆë‹¤. í˜¹ì‹œë‚˜ í•´ì„œ `console.log`ë„ ì¶”ê°€í•´ë´¤ìŠµë‹ˆë‹¤.

```tsx app/layout.tsx
export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <head>
        {/* !mark(1:5) */}
        <script src="/env.js" />
        <script
          dangerouslySetInnerHTML={{
            __html: `console.log("API Endpoint:", window.API_ENDPOINT);`,
          }}
        />
      </head>
      <body className={`${geistSans.variable} ${geistMono.variable}`}>
        {children}
      </body>
    </html>
  );
}
```

ê·¸ ì™¸ì— `env.js` íŒŒì¼ì„ ìƒì„±í•˜ëŠ” ë¶€ë¶„, í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •í•˜ëŠ” ë¶€ë¶„ ë“±ì€ ëª¨ë‘ ë˜‘ê°™ì•„ì„œ íŒ¨ìŠ¤í•˜ê² ìŠµë‹ˆë‹¤. ë¹Œë“œì™€ ì‹¤í–‰ë„ ë˜‘ê°™ìŠµë‹ˆë‹¤.

```sh
# ë¡œì»¬ ë¹Œë“œ ë° ì‹¤í–‰
npm run build
API_ENDPOINT=https://jsonplaceholder.typicode.com npm run start

# ë¡œì»¬ì—ì„œ ë„ì»¤ ë¹Œë“œ ë° ì‹¤í–‰
docker build --force-rm=true -t inject-env .
docker run -p 3000:3000 --rm -it -e API_ENDPOINT=https://jsonplaceholder.typicode.com inject-env
```

## ì‹¤íŒ¨í•œ ì‹œë„

ğŸ¥² ì•„ë˜ ë°©ë²•ì€ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.

```tsx pages/_document.tsx
<Head>
  <script
    dangerouslySetInnerHTML={{
      __html: `
console.log('This script runs on the server side and is injected into the head of the document.');
window.API_ENDPOINT = "${process.env.API_ENDPOINT}";`,
    }}
  />
</Head>
```

ì²˜ìŒì—ëŠ” ìœ„ì²˜ëŸ¼ ì§ì ‘ `script`ì™€ `dangerouslySetInnerHTML`ë¥¼ ì´ìš©í•˜ì—¬ í™˜ê²½ë³€ìˆ˜ë¥¼ ë„£ì–´ì¤¬ì§€ë§Œ ë¹Œë“œ ì‹œì  í™˜ê²½ë³€ìˆ˜ë¡œ ê³ ì •ë˜ì–´ì„œ ì˜ì˜ ì‚¬ìš©í•  ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤. Static Site Generation í˜ì´ì§€ì¸ì§€ ì•„ë‹Œì§€ íŒë‹¨í•˜ëŠ” ê¸°ì¤€ì„ ì •í™•íˆ ì•Œ ìˆœ ì—†ì§€ë§Œ, ì¼ë‹¨ SSGë¡œ ë¹Œë“œëë‹¤ë©´ ê·¸ í˜ì´ì§€ëŠ” ì‹¤í–‰ ì‹œì ì— ë³€ê²½í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ í™˜ê²½ë³€ìˆ˜ë¡œë„ ì œì–´í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

## í•œê³„

`env.js`ë¥¼ ì‚½ì…í•˜ëŠ” ë°©ì‹ì€ Next.js ê°€ ì–¸ê¸‰í•˜ëŠ” íŒ¨í„´ë„ ì•„ë‹ˆê³ , ì €ëŸ° ë‹¨ìˆœë¬´ì‹í•œ `script` íƒœê·¸ ì‚½ì…ê³¼ ê´€ë ¨í•˜ì—¬ `next build`ì˜ ìƒì„¸í•œ ê³¼ì •ì´ë‚˜ ë¡œì§ì´ ë¬¸ì„œì— ëª…ì‹œë˜ì–´ ìˆëŠ” ê²ƒë„ ì•„ë‹ˆë¼ì„œ ì¢€ ë¶ˆì•ˆí•©ë‹ˆë‹¤. ìš°ë¦¬ê°€ ì„ì˜ë¡œ ì‚½ì…í•œ ìŠ¤í¬ë¦½íŠ¸ê°€ Next.js ë‚´ë¶€ ë¹Œë“œ ë¡œì§ ë³€í™”ì— ì˜í•´ ì–¸ì œë“ ì§€ ì˜í–¥ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì¡°ê¸ˆ ë” ê²€ì¦ëœ ë°©ë²•ì´ í•„ìš”í•˜ë‹¤ë©´ [next-runtime-env](https://www.npmjs.com/package/next-runtime-env) ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ëœ¯ì–´ë³´ì‹œëŠ” ê²ƒë„ ì¢‹ì„ ê²ƒ ê°™ì•„ìš”. ì €ë„ ì—¬ê¸° ì†ŒìŠ¤ì½”ë“œë¥¼ í¬ê²Œ ì°¸ì¡°í•˜ì—¬ ì´ ê¸€ì˜ ì•„ì´ë””ì–´ë¥¼ ì–»ì—ˆìŠµë‹ˆë‹¤. ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ ìœ ì‹¬íˆ ì‚´í´ë³´ì‹œë ¤ë©´ [next-runtime-env ì›ë¦¬ íŒŒí—¤ì¹˜ê¸°(by ê°œë°œì ë¥˜ì¤€ì—´)](https://www.wnsdufdl.com/post/eCulLQxzTrSoL7asxyqUNA) ê¸€ë„ ì°¸ì¡°í•´ì£¼ì‹œë©´ ì¢‹ìŠµë‹ˆë‹¤.

Next.jsê°€ ê³µì‹ì ìœ¼ë¡œ ì¶”ì²œí•˜ëŠ” ë°©ë²•ì€ [getServerSideProps](https://nextjs.org/docs/pages/guides/environment-variables#runtime-environment-variables)ë¥¼ ì“°ê±°ë‚˜ App Routerì˜ ì„œë²„ ì»´í¬ë„ŒíŠ¸ë¡œ í•˜ë¼ í•˜ë„¤ìš”. ê·¸ë ‡ê²Œ í•´ì„œ í•´ê²°í•  ìˆ˜ ìˆë‹¤ë©´ êµ¿.

## ë²ˆì™¸

`env.js` íŒŒì¼ì„ ìƒì„±í•  ë•Œ [instrumentation.ts íŒŒì¼](https://nextjs.org/docs/pages/guides/instrumentation)([App Router](https://nextjs.org/docs/app/guides/instrumentation))ì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆê² ìŠµë‹ˆë‹¤. ì €ëŠ” ì—ë„ˆì§€ê°€ ë‹¤í–ˆìœ¼ë‹ˆ ì—¬ëŸ¬ë¶„ì´ í•œë²ˆ ì‹œë„ í•´ì£¼ì„¸ìš”...

## ë ˆí¼ëŸ°ìŠ¤

- ì†ŒìŠ¤ì½”ë“œ(Pages Router): https://github.com/echoja/inject-env-nextjs-pages-router
- ì†ŒìŠ¤ì½”ë“œ(App Router): https://github.com/echoja/inject-env-nextjs-app-router
- [next-runtme-env - npm](https://www.npmjs.com/package/next-runtime-env)
- [Adding Custom Environment Variables | Create React App](https://create-react-app.dev/docs/adding-custom-environment-variables/)
- [Routing: Custom Document | Next.js](https://nextjs.org/docs/pages/building-your-application/routing/custom-document)
- [`NEXT_PUBLIC_` í™˜ê²½ë³€ìˆ˜ë¥¼ ë¹Œë“œ ì´í›„ì— ìˆ˜ì •í•  ìˆœ ì—†ë‚˜? í•¨ê»˜ ì•Œì•„ë³´ì.(by Jihan)](https://velog.io/@bbbjihan/NEXTPUBLIC-%ED%99%98%EA%B2%BD%EB%B3%80%EC%88%98%EB%A5%BC-%EB%B9%8C%EB%93%9C-%EC%9D%B4%ED%9B%84%EC%97%90-%EC%88%98%EC%A0%95%ED%95%A0-%EC%88%9C-%EC%97%86%EB%82%98-%ED%95%A8%EA%BB%98-%EC%95%8C%EC%95%84%EB%B3%B4%EC%9E%90)
- [next-runtime-env ì›ë¦¬ íŒŒí—¤ì¹˜ê¸°(by ê°œë°œì ë¥˜ì¤€ì—´)](https://www.wnsdufdl.com/post/eCulLQxzTrSoL7asxyqUNA)
