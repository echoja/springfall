import ArticleHeader from "@modules/article/ArticleHeader";
import ArticleImage from "@modules/article/ArticleImage";
import getArticleHeaderProps from "@modules/metadata/getArticleHeaderProps";
import getArticleJsonLdProps from "@modules/metadata/getArticleJsonLdProps";
import getArticleMetadata from "@modules/metadata/getArticleMetadata";
import { ArticleJsonLd } from "next-seo";
import { item } from "./metadata";
import i0 from "./i0.png";
import i1 from "./i1.jpg";
import i2 from "./i2.png";
import i3 from "./i3.png";
import i4 from "./i4.png";
import i99 from "./i99.png";
import preamble from "./preamble.png";
import su from "./su.png";
import stair from "./stair.png";
import t1 from "./t1.png";
import t2 from "./t2.png";
import intro from "./intro.png";

export const metadata = getArticleMetadata(item);

<ArticleJsonLd {...getArticleJsonLdProps(item)} />

<ArticleHeader {...getArticleHeaderProps(item)} />

<ArticleImage img={i1} alt="í¬ìŠ¤íŠ¸ì‡ ì‚¬ì§„" caption={<>

ì–´ë–»ê²Œ ìƒê²¼ëŠ”ì§€ë„ ì˜ˆì¸¡í•˜ê¸° í˜ë“  ê³ ê°ì˜ ì‚¬ì´íŠ¸ì—ì„œ ë­”ê°€ê°€ ì˜ ë™ì‘í•˜ê²Œë” í•˜ê¸°ë€, ë§ˆì¹˜ ì–´ë””ì—ë‚˜ ì˜ ë¶™ëŠ” í¬ìŠ¤íŠ¸ì‡ì„ ê°œë°œí•˜ëŠ” ê²ƒê³¼ ê°™ë‹¤. ì‚¬ì§„: <a href="https://unsplash.com/ko/%EC%82%AC%EC%A7%84/%EC%9D%B8%EC%87%84%EB%90%9C-%EC%8A%A4%ED%8B%B0%EC%BB%A4-%EB%A9%94%EB%AA%A8%EA%B0%80-%EB%B3%B4%EB%93%9C%EC%97%90-%EC%A0%91%EC%B0%A9%EB%90%98%EC%96%B4-%EC%9E%88%EC%8A%B5%EB%8B%88%EB%8B%A4-zoCDWPuiRuA?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Unsplash</a> by <a href="https://unsplash.com/ko/@epicantus?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Daria Nepriakhina ğŸ‡ºğŸ‡¦</a>

</>} />

## ëª©ì°¨

## ìš”êµ¬ì‚¬í•­

ìš°ë¦¬ê°€ íŒë§¤í•˜ëŠ” ì œí’ˆì€ **ì›¹ì‚¬ì´íŠ¸ ê´‘ê³  ë°°ë„ˆ ë Œë”ë§ ì‹œìŠ¤í…œ**ì´ë©° ê³ ê°ì€ **ì‚¬ì´íŠ¸ ìš´ì˜ì**ì…ë‹ˆë‹¤. ìš°ë¦¬ê°€ ê³ ê°ì˜ ì¸í”„ë¼ë‚˜ ìì‚°ì— ì§ì ‘ ì ‘ê·¼í•˜ì—¬ ê°œë°œí•´ì£¼ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ìŠ¤í¬ë¦½íŠ¸ í•˜ë‚˜ë¥¼ ë™ì‘ì‹œì¼œì„œ ê´‘ê³  ë°°ë„ˆë¥¼ ë…¸ì¶œí•  ê²ƒì…ë‹ˆë‹¤. ê³ ê°ì´ ë”± í•˜ë‚˜ì˜ ì‘ì—…ë§Œ í•´ì¤˜ì•¼ í•˜ëŠ”ë°ìš”, ì•„ë˜ì™€ ê°™ì´ `main` ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìì‹ ì˜ ì‚¬ì´íŠ¸ì— ì‚½ì…í•´ë†“ëŠ” ê²ƒì…ë‹ˆë‹¤.

```html
<script
  src="https://cdn.banner.com/main.js?site_id=mysite"
  type="module"
></script>
```

ë˜í•œ, **ê´‘ê³  ë°°ë„ˆë¥¼ ì–´ëŠ ìœ„ì¹˜ì— ì‚½ì…í•  ê±´ì§€ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ì§€ì •í•  ìˆ˜ ìˆëŠ” ë„êµ¬**ì¸ `live-locator` ë¼ëŠ” ê¸°ëŠ¥ë„ ì œê³µí•©ë‹ˆë‹¤. ê³ ê° ì‚¬ì´íŠ¸ì™€ ìƒí˜¸ì‘ìš©í•˜ë©´ì„œë„ ë³µì¡í•œ UIê°€ ê³ ê° ì‚¬ì´íŠ¸ì— Floating ë˜ì–´ ë™ì‘í•©ë‹ˆë‹¤. `main` ìŠ¤í¬ë¦½íŠ¸ì™€ `live-locator` ìŠ¤í¬ë¦½íŠ¸ëŠ” ë¶„ë¦¬ë˜ì–´ ìˆê³ , ìƒí™©ì— ë”°ë¼ **ë™ì ìœ¼ë¡œ ë¡œë”©**ë˜ì–´ ì‚¬ì´íŠ¸ ì„±ëŠ¥ì„ í•´ì¹˜ì§€ ì•Šìœ¼ë©´ì„œë„ ìš´ì˜ìë§Œ ì—ë””í„°ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„í•©ë‹ˆë‹¤.

ëª¨ë“  ë¹Œë“œëŠ” Vite ê¸°ë°˜ìœ¼ë¡œ í•©ë‹ˆë‹¤. ê²°ê³¼ë¬¼ì€ S3(+CloudFront) ì— ì—…ë¡œë“œí•˜ëŠ” ê²ƒì„ ì „ì œë¡œ í•©ë‹ˆë‹¤.

> ì´ ê¸€ì€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ êµ¬í˜„í•˜ê³ ì í•˜ëŠ” ëª©ì ì´ ì—†ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ë°°ë„ˆë‹ˆ ì‹¤ì‹œê°„ ìœ„ì¹˜ ì„¤ì •ì´ë‹ˆ í•˜ëŠ” ê±´ ë‹¨ìˆœí•œ ì˜ˆì‹œì¼ ë¿ì´ë¼ëŠ” ì ì„... ë¯¸ë¦¬ ë§ì”€ë“œë¦½ë‹ˆë‹¤.

## ìš”êµ¬ì‚¬í•­ì„ ë³´ê³  ì´ ê¸€ì˜ ì œëª©ì„ í•´ì„í•´ë³´ì

ì œëª©ì´ ìƒë‹¹íˆ ì§¬ë½•ì´ì§€ìš”? ì´ ê¸€ì€ ë‚´ìš©ì´ ê¸¸ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ëª¨ë“  í† ë¼ë¥¼ ì¡ì•„ì•¼ í•˜ê±°ë“ ìš”.

- **ê³ ê°ì˜ ì‚¬ì´íŠ¸**ì—ì„œ: ìš°ë¦¬ê°€ ì†Œìœ í•œ ì¸í”„ë¼ë‚˜ í™˜ê²½ì—ì„œ ë™ì‘í•˜ëŠ” ì•±ì„ ê°œë°œí•˜ëŠ” ì•„ë‹ˆë¼ëŠ” ëœ»ì…ë‹ˆë‹¤. ì œì•½ì‚¬í•­ì´ ì´ê²ƒì €ê²ƒ ë§ì•„ì§‘ë‹ˆë‹¤.
- **React + Tailwind ì•±**: í”„ë¡ íŠ¸ ì•± ê°œë°œì— ìˆì–´ì„œ ìƒì‚°ì„±ì„ ê·¹ì ìœ¼ë¡œ ì˜¬ë ¤ì£¼ëŠ” ë„êµ¬ì…ë‹ˆë‹¤. ì“¸ ìˆ˜ ìˆë‹¤ë©´ ì“°ë©´ ì¢‹ê² ì£ . ìµìˆ™í•˜ê¸°ë„ í•˜êµ¬ìš”.
- **íš¨ìœ¨ì ìœ¼ë¡œ**: DXê°€ ì¢‹ì•„ì•¼ í•œë‹¤ëŠ” ë§ì…ë‹ˆë‹¤. ê°œë°œ í™˜ê²½ê³¼ í”„ë¡œë•ì…˜ í™˜ê²½ ì‚¬ì´ì— í° ì°¨ì´ê°€ ì—†ë„ë¡ í™˜ê²½ì„ ë§Œë“¤ê³  HMRë„ ì˜ ë™ì‘í•˜ë„ë¡ ì¡°ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.
- **Production Ready**: DXë¿ë§Œ ì•„ë‹ˆë¼ ì‹¤ì œ ê³ ê° ì…ì¥ì—ì„œ ì‚¬ì´íŠ¸ê°€ **ë¬¸ì œì—†ì´ ì˜** ë™ì‘í•´ì•¼ í•©ë‹ˆë‹¤.

## ìš”êµ¬ì‚¬í•­ ë¶„ì„

### ìŠ¤í¬ë¦½íŠ¸ë€ ë¬´ì—‡ì¼ê¹Œ

ìŠ¤í¬ë¦½íŠ¸ë€ ë¬´ì—‡ì´ê³ , ì–´ë–¤ ìŠ¤í¬ë¦½íŠ¸ê°€ í•„ìš”í•œì§€ ë´…ì‹œë‹¤.

ìš°ë¦¬ëŠ” ìš°ë¦¬ê°€ ì†Œìœ í•œ ì„œë¹„ìŠ¤ì—ì„œ ê°œë°œí•˜ëŠ” ê²Œ ì•„ë‹™ë‹ˆë‹¤. **ë‹¤ë¥¸ ì´ì˜ ì‚¬ì´íŠ¸ì—ì„œ ì˜ ë™ì‘í•˜ëŠ” ê¸°ëŠ¥**ì„ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤. ê·¸ë ‡ë‹¤ë©´ ê³ ê° íšŒì‚¬ë¡œ íŒŒê²¬ì„ ë‚˜ê°€ì„œ ê·¸ ìª½ì˜ ì½”ë“œë¥¼ ì§ì ‘ ìˆ˜ì •í•´ì¤˜ì•¼ í• ê¹Œìš”? ê·¸ëŸ° ìˆ˜ê³ ë¡œì›€ì„ ìµœì†Œí™”í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ìˆëŠ”ë°ìš”, ë°”ë¡œ **ìŠ¤í¬ë¦½íŠ¸**ë¥¼ ì‚½ì…í•˜ëŠ” ê²ë‹ˆë‹¤. ìŠ¤í¬ë¦½íŠ¸ê°€ ì‚½ì…ë˜ì–´ ìˆìœ¼ë©´ ìš°ë¦¬ê°€ ì‘ì„±í•œ ì½”ë“œë¥¼ ê·¸ ìª½ì˜ ì‚¬ì´íŠ¸ì—ì„œ ë™ì‘ì‹œí‚¤ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìŠ¤í¬ë¦½íŠ¸ëŠ” ë§ ê·¸ëŒ€ë¡œ `<script src="...">`ë¥¼ ëœ»í•©ë‹ˆë‹¤.

ê°„ë‹¨í•˜ê²Œ ì˜ˆì‹œë¥¼ í•œë²ˆ ì‚´í´ë´…ì‹œë‹¤. ì „ì§€í˜„ì´ ê´‘ê³ í•˜ëŠ” [Andar](https://andar.co.kr/)ë¼ëŠ” ë¸Œëœë“œì˜ ì‡¼í•‘ëª° ì‚¬ì´íŠ¸ë¥¼ ê¹Œë´¤ëŠ”ë°ìš”, ì˜¨ê°– ì¨ë“œíŒŒí‹° ìŠ¤í¬ë¦½íŠ¸ê°€ ë™ì‘í•˜ëŠ” ê±¸ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

<ArticleImage
  img={i0}
  alt="Andar ì‚¬ì´íŠ¸ì˜ devtools"
  border
  caption="Andar ì‚¬ì´íŠ¸ì˜ ì½”ë“œë¥¼ ê¹Œë³´ë©´ ì˜¨ê°– ìŠ¤í¬ë¦½íŠ¸ê°€ ë¡œë“œë˜ê³  ìˆë‹¤."
/>

ìœ„ ì´ë¯¸ì§€ë§Œ ë´¤ì„ ë•Œ ëˆˆì— ë„ëŠ” ì„œë¹„ìŠ¤ë“¤ì´ ìˆë„¤ìš”.

- [Beusable](https://www.beusable.net/): ì‚¬ìš©ì í–‰ë™ ë¶„ì„ ë„êµ¬
- [í¬ë¦¬ë§ˆ(CREMA)](https://www.cre.ma/): ë¦¬ë·° ë°ì´í„° ê¸°ë°˜ ë§ˆì¼€íŒ… í”Œë«í¼
- [Google Tag Manager](https://tagmanager.google.com/): ì›¹/ì•± ì½”ë“œ ìˆ˜ì • ì—†ì´ ë‹¤ì–‘í•œ ë§ˆì¼€íŒ…Â·ì¸¡ì • íƒœê·¸ë¥¼ í•œ ëŒ€ì‹œë³´ë“œì—ì„œ ë°°í¬Â·ê´€ë¦¬í•˜ëŠ” íƒœê·¸ ê´€ë¦¬ ì‹œìŠ¤í…œ.

ìŠ¤í¬ë¦½íŠ¸ ì„¤ì¹˜(ì‚½ì…)ëŠ” ì‡¼í•‘ëª° ìš´ì˜ìê°€ í•´ì£¼ê¸°ëŠ” í•´ì•¼ í•©ë‹ˆë‹¤. ê·¸ ì´í›„ëŠ” ìŠ¤í¬ë¦½íŠ¸ì˜ ì°¨ë¡€ì…ë‹ˆë‹¤.

### Reactë€ ë¬´ì—‡ì¼ê¹Œ

ReactëŠ” ì›¹ì•±ì„ ë§Œë“¤ê¸° ìœ„í•œ í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤. ì „ì„¸ê³„ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œìë“¤ì—ê²ŒëŠ” ì•„ì£¼ ìµìˆ™í•©ë‹ˆë‹¤. ì´ëŸ° í”„ë ˆì„ì›Œí¬ì˜ ì¥ì ì€ ë‹¤ì–‘í•œ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œìê°€ ê°™ì€ ê°œë…, ê°™ì€ ì´ì•¼ê¸°ë¥¼ í•  ìˆ˜ ìˆë„ë¡ í•˜ì—¬ ìƒì‚°ì„±ì„ ì˜¬ë ¤ì¤€ë‹¤ëŠ” ê²ë‹ˆë‹¤. ê·¸ë˜ì„œ ì›¹ì•±ì„ ê³„ì†í•´ì„œ ì˜ ê°œë°œí•´ì•¼ í•œë‹¤ë©´ ì´ëŸ° í”„ë ˆì„ì›Œí¬ë¥¼ ì“°ëŠ” ê²Œ ìƒì‚°ì„± ì¸¡ë©´ì—ì„œ ì¢‹ì„ ë•Œê°€ ë§ìŠµë‹ˆë‹¤. ìš°ë¦¬ê°€ ë§Œë“¤ê³ ì í•˜ëŠ” `live-locator`ë„ ì˜ˆì™¸ëŠ” ì•„ë‹™ë‹ˆë‹¤.

ë‹¨, **`main` ìŠ¤í¬ë¦½íŠ¸ì—ì„œëŠ” Reactë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.** ìƒì‚°ì„± í–¥ìƒì˜ ì¥ì ë³´ë‹¤ ë¡œë”© ì†ë„ê°€ ëŠë ¤ì§„ë‹¤ëŠ” ë‹¨ì ì´ í›¨ì”¬ í¬ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì´ë²ˆì— ë¹Œë“œí•´ë´¤ì„ ë•Œ Reactì˜ ìš©ëŸ‰ì€ ëŒ€ëµ 200 KBì˜€ìŠµë‹ˆë‹¤. 5 Mbpsì˜ ì†ë„ë¼ë©´ ëŒ€ì¶© 0.3ì´ˆì˜ ì§€ì—°ì‹œê°„ì´ ì¶”ê°€ë¡œ ë°œìƒí•´ë²„ë¦½ë‹ˆë‹¤.

ìœ„ì—ì„œ ì–¸ê¸‰í•œ ì¨ë“œíŒŒí‹° ìŠ¤í¬ë¦½íŠ¸ ë˜í•œ UIê°€ í•„ìš”í•œ ê²Œ ì•„ë‹ˆë¼ ì‚¬ìš©ì ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ê¸°ëŠ¥ìœ¼ë¡œ ì¶©ë¶„í•˜ê¸° ë•Œë¬¸ì— Reactê°™ì€ ë¬´ê±°ìš´ í”„ë ˆì„ì›Œí¬ê°€ í•„ìš” ì—†ìŠµë‹ˆë‹¤.

ReactëŠ” í¸ë¦¬í•œ ê°œë°œ í™˜ê²½ì„ ì œê³µí•©ë‹ˆë‹¤. íŠ¹íˆ Hot Module Replacing(ì´í•˜ HMR)ì€ ì •ë§ ì¢‹ìŠµë‹ˆë‹¤. ë§Œì•½ ì—†ìœ¼ë©´ ë§¤ë²ˆ ìƒˆë¡œê³ ì¹¨í•´ì•¼ í•  ê²ë‹ˆë‹¤. ìš°ë¦¬ì˜ `live-locator` ë˜í•œ ì´ëŸ° í¸ë¦¬í•œ ê°œë°œ í™˜ê²½ì„ ëˆ„ë¦¬ê²Œ í•´ì¤˜ì•¼ê² ìŠµë‹ˆë‹¤.

### ë™ì  ë¡œë”©

`main` ìŠ¤í¬ë¦½íŠ¸ëŠ” ì¡°ê±´ì— ë§ì„ ë•Œì—ë§Œ (ê´€ë¦¬ìê°€ ëª…ì‹œì ìœ¼ë¡œ `live-locator` ì“°ê² ë‹¤ í•  ë•Œì—ë§Œ) ê·¸ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¡œë”©í•´ì•¼ í•©ë‹ˆë‹¤. ë¬´ì—‡ì„ ê¸°ì¤€ìœ¼ë¡œ ì‚¼ì„ê¹Œìš”? ì¼ë‹¨ì€ `?bannerLocator=1` ë¼ëŠ” searchParamsê°€ ìˆìœ¼ë©´ ë¡œë“œë˜ë„ë¡ ê°„ë‹¨íˆ í•©ì‹œë‹¤. ë¡œë“œëŠ” `<script>` Elementë¥¼ ë§Œë“¤ì–´ ë„£ì–´ì¤ì‹œë‹¤.

### ê²©ë¦¬ë¥¼ ì–´ë–»ê²Œ ì‹œí‚¬ê¹Œ

Reactì™€ ê°™ì€ í”„ë ˆì„ì›Œí¬ëŠ” **ë‚´**ê°€ **ë‚´ ì„œë¹„ìŠ¤** ë§Œë“¤ ë•Œ ì“°ë¼ê³  ë§Œë“  ê±°ì§€ **ë‚¨ì˜ ì„œë¹„ìŠ¤** ìœ„ì— **ë‚´ ì„œë¹„ìŠ¤**ë¥¼ ì–¹ê¸° ìœ„í•´ ë‚˜ì˜¨ ê²Œ ì•„ë‹™ë‹ˆë‹¤. ê·¸ë˜ì„œ ë‹¹ì—°íˆ ë‚¨ì˜ ì„œë¹„ìŠ¤ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ” ê¸°ëŠ¥ ê°™ì€ ê±´ ê³ ë ¤ëœ ê²Œ ì—†ì„ ê²ë‹ˆë‹¤. `live-locator`ë¥¼ Reactë¡œ ê°œë°œí•œë‹¤ê³  í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ìƒí™©ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- live-locator ì•ˆì— ìˆëŠ” `div.container` ì—ë§Œ ìŠ¤íƒ€ì¼ì„ ì§€ì •í•˜ë ¤ê³  í–ˆëŠ”ë°, ê³ ê° ì‚¬ì´íŠ¸ì— ìˆë˜ `div.container`ê°€ ì˜í–¥ì„ ë°›ëŠ”ë‹¤!
- live-locatorëŠ” Reactë¥¼ ì‚¬ìš©í•˜ëŠ”ë°, ê³ ê° ì‚¬ì´íŠ¸ë„ Reactë¥¼ ì¨ì„œ ì–´ë–¤ ê¸€ë¡œë²Œ ë³€ìˆ˜ê°€ ì„œë¡œ ì¶©ëŒí•œë‹¤! (ì¬ì°¨ ë§í•˜ì§€ë§Œ, ReactëŠ” ë³¸ë˜ **í•˜ë‚˜**ì˜ ì™„ì „í•œ ì›¹ì•±ìœ¼ë¡œ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.)

ë•Œë¬¸ì— ìŠ¤íƒ€ì¼ì„ ê²©ë¦¬ì‹œí‚¤ê¸° ì‰¬ìš´ **Shadow DOM + Custom Element** ë°©ë²•ì„ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤. ì´ ë°©ë²•ì´ ë§ŒëŠ¥ì€ ì•„ë‹ˆê² ì§€ë§Œ, ì‰½ê³  ë¹ ë¥´ê²Œ ì ìš© ê°€ëŠ¥í•œ ë°©ë²•ì´ë¼ê³  ìƒê°í•˜ê³  ì„ íƒí–ˆìŠµë‹ˆë‹¤.

## ë¹„ìŠ·í•œ ì‚¬ë¡€

**Vercel Toolbar** ê¸°ëŠ¥ì„ ì•„ì‹œë‚˜ìš”? Vercelì€ Next.js ë“±ì˜ ì›¹ì•±ì„ í¸í•˜ê²Œ ë°°í¬í•´ì£¼ëŠ” ì„œë¹„ìŠ¤ì¸ë°ìš”, `main` ë¸Œëœì¹˜ê°€ ì•„ë‹ˆë¼ ì‘ì—… ì¤‘ì¸ ë¸Œëœì¹˜ë¥¼ ë”°ê³  PRì„ ë§Œë“¤ê³  í•˜ë©´ì€ í•´ë‹¹ ë¸Œëœì¹˜ì˜ ìµœì‹  ë²„ì „ìœ¼ë¡œ í…ŒìŠ¤íŠ¸(Preview)í•  ìˆ˜ ìˆëŠ” ë¹Œë“œê°€ ìƒê¹ë‹ˆë‹¤.

ì•„ë˜ëŠ” `test` ë¸Œëœì¹˜ì—ì„œ ì‘ì—…í•œ ë‚´ìš©ì´ `zip-up-git-â€¦vercel.app`ìœ¼ë¡œ ë°°í¬ë˜ëŠ” ëª¨ìŠµì…ë‹ˆë‹¤.

<ArticleImage img={i2} border caption="" alt="" />

ì € ì£¼ì†Œë¡œ ë“¤ì–´ê°€ë©´ ìš°ì¸¡ì— ì¡°ê·¸ë§ˆí•œ ë²„íŠ¼ì´ ë– ìˆëŠ” ê±¸ ë³¼ ìˆ˜ ìˆê³ , ê·¸ê±¸ ëˆ„ë¥´ë©´ ì•„ì£¼ ë³µì¡í•œ ê¸°ëŠ¥ì´ ë‚´ ì‚¬ì´íŠ¸ì—ì„œ ëœ¨ëŠ” ê±¸ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìš”ì§€ëŠ” **ë‚˜ì˜ ì‚¬ì´íŠ¸ì— ë‚´ê°€ ë§Œë“¤ì§€ ì•Šì€ ê¸°ëŠ¥ì´ ìƒê²¼ë‹¤ëŠ” ê²ƒ**ì…ë‹ˆë‹¤! ìš°ë¦¬ê°€ `live-locator`ë¥¼ ì˜ ë§Œë“¤ì–´ì•¼ í•˜ëŠ” ìƒí™©ê³¼ ì•„ì£¼ ìœ ì‚¬í•©ë‹ˆë‹¤.

<ArticleImage img={i3} border caption="" alt="" />

ì´ê²Œ ì–´ë””ì„œ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ” ê±¸ê¹Œìš”?

Next.js ì•±ì´ Vercelì—ì„œ ë¹Œë“œë  ë•Œ Vercel Toolbarë¥¼ ë¡œë“œí•˜ëŠ” ì½”ë“œ ìŠ¤ë‹ˆí«ì´ ìë™ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤. ê°€ì¥ ë¨¼ì € ë¡œë“œë˜ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ì¸ `webpack-xxx.js` ì˜ ìµœí•˜ë‹¨ì—ì„œ ì•„ë˜ì™€ ê°™ì€ ì½”ë“œê°€ ìˆë‹¤ëŠ” ê±¸ í™•ì¸í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```jsx
(function () {
  if (typeof document === "undefined") return;
  var s = document.createElement("script");
  s.src = "https://vercel.live/_next-live/feedback/feedback.js";
  s.setAttribute("data-deployment-id", "dpl_xxxxx");
  (document.head || document.documentElement).appendChild(s);
})();
```

ì´ ì½”ë“œëŠ” Vercelì—ì„œ ë§Œë“  `feedback.js` ìë°”ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì„ ë¡œë“œí•˜ê²Œ ë˜ê³ , ì´ ìŠ¤í¬ë¦½íŠ¸ê°€ ì—°ì‡„ì ìœ¼ë¡œ ì˜¨ê°– ë¦¬ì†ŒìŠ¤ë¥¼ ë¡œë“œí•˜ê³  ë™ì‘ì‹œí‚µë‹ˆë‹¤. ê²°ê³¼ì ìœ¼ë¡œ ì•„ë˜ì™€ ê°™ì€ Elementê°€ body í•˜ë‹¨ì— ì‚½ì…ë©ë‹ˆë‹¤.

```html
<vercel-live-feedback
  style="position: absolute; top: 0px; left: 0px; z-index: 2147483647;"
></vercel-live-feedback>
```

ì´ í¬í•œí•˜ê²Œ ìƒê¸´ ìš”ì†ŒëŠ” `vercel-live-feedback`ë¼ëŠ” ì´ë¦„ì„ ê°€ì§„ Custom Element ì…ë‹ˆë‹¤. ì´ ìš”ì†Œì˜ shadowRootë¥¼ ê¹Œë³´ë©´ ì—„ì²­ë‚˜ê²Œ ë§ì€ style íƒœê·¸ê°€ ìˆê³ , ê°ì¢… Elementë„ ë§ê³ , Reactë¥¼ í¬í•¨í•œ ì»¤ë‹¤ë€ ìŠ¤í¬ë¦½íŠ¸ê°€ ë¡œë“œë˜ëŠ” ê²ƒë„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<ArticleImage
  img={i4}
  border
  caption="ë¡œë“œë˜ëŠ” ë‹¤ì–‘í•œ Vercel Toolbar ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸. ë²ˆë“¤ë§ëœ ë‚´ìš© ì†ì—ì„œ useEffectë¥¼ ë°œê²¬í•  ìˆ˜ ìˆë‹¤(Reactê°€ ì“°ì˜€ë‹¤ëŠ” ì¦ê±°)"
  alt="ë¡œë“œë˜ëŠ” ë‹¤ì–‘í•œ Vercel Toolbar ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸"
/>

## ìš”êµ¬ì‚¬í•­ ì •ë¦¬

ë§Œë“¤ì–´ì•¼ í•  ê±´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

- **`main` ìŠ¤í¬ë¦½íŠ¸**: ë°°ë„ˆ ë Œë”ë§ ì‹œìŠ¤í…œ. ìš©ëŸ‰ì€ ì ì–´ì•¼ í•¨. êµ¬ì¡°ëŠ” ì‹¬í”Œí•˜ê²Œ.
- **`live-locator` ìŠ¤í¬ë¦½íŠ¸**: ì‚¬ì´íŠ¸ ìš´ì˜ì ì „ìš© ì¶”ê°€ ë„êµ¬. ì¡°ê±´ì— ë”°ë¼ `main`ì´ ì¶”ê°€ ë¡œë“œí•©ë‹ˆë‹¤. React + Tailwind ê¸°ë°˜.

## ì†ŒìŠ¤ì½”ë“œ ë° ë°ëª¨

<ArticleImage
  img={intro}
  alt="ë°°ë„ˆ ë„êµ¬ ë°ëª¨ í˜ì´ì§€ ëª¨ìŠµ"
  border
  caption="ë°°ë„ˆ ë„êµ¬ ë°ëª¨ í˜ì´ì§€ ëª¨ìŠµ"
/>

- https://github.com/echoja/mini-multi-scripts
- https://mini-multi-scripts-live-locator.vercel.app/

## í”„ë¡œì íŠ¸ ì„¸íŒ…

ê°„ë‹¨í•œ ëª¨ë…¸ë ˆí¬ë¡œ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤. ì „ì²´ íŒŒì¼ì€ ìì˜í•œ íŒŒì¼ë“¤ ì œì™¸í•˜ê³  ì•„ë˜ ì •ë„ê°€ ë˜ê² ìŠµë‹ˆë‹¤.

```txt
package.json
packages/main/src/main.ts
scripts/build.mjs
packages/main/package.json
packages/main/index.html
packages/main/vite.config.mts
packages/main/public/banner-locations.json
packages/live-locator/package.json
packages/live-locator/vite.config.mts
packages/live-locator/index.html
packages/live-locator/src/live-locator.tsx
packages/live-locator/src/LiveLocatorApp.tsx
packages/live-locator/src/live-locator.css
packages/live-locator/src/utils/selector.ts
```

íŠ¹ì´í• ë§Œí•œ ì ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

- packages/main/ í´ë”: `main` ìŠ¤í¬ë¦½íŠ¸ í”„ë¡œì íŠ¸ (ë‹¨ìˆœ Vite)
- packages/live-locator/ í´ë”: `live-locator` ìŠ¤í¬ë¦½íŠ¸ í”„ë¡œì íŠ¸ (Vite + React + Tailwind)
- scripts/build.mjs: ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸ (`npm run build` í•˜ê²Œ ë˜ë©´ ì‹¤í–‰ë¨)

ë¹Œë“œ ë° ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ëŠ” Jenkinsë¡œ í•˜ë“ , GitHub Actionsë¡œ í•˜ë“ , ìŠ¤í¬ë¦½íŠ¸ë¡œ ë§Œë“¤ì–´ ì •ì˜í•˜ë“  í•„ìš”í•˜ê¸´ í•©ë‹ˆë‹¤. ìµœì¢… ì‚°ì¶œë¬¼ì€ **ìë°”ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼**ì´ë©° ì´ê±´ ì–´ë”˜ê°€ì— ì˜ ì—…ë¡œë“œê°€ ë˜ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì‹¤ì œë¡œëŠ” [S3](https://aws.amazon.com/ko/s3)ê°™ì€ ê³³ì— ì˜¬ë ¤ì„œ CDNì„ íƒœìš°ê¸°ë§Œ í•˜ë©´ ì¶©ë¶„í•©ë‹ˆë‹¤.

ì´ ë°ëª¨ëŠ” Vercelì— ê°„ë‹¨íˆ ì—…ë¡œë“œí•©ë‹ˆë‹¤. Vercel ë°°í¬ ì„¤ì •ì—ì„œ output í´ë”ë¥¼ ëª…ì‹œí•˜ê³  ê·¸ ê³³ì— ë¹Œë“œ ê²°ê³¼ë¬¼ì„ ëª¨ì•„ë‘ê¸°ë§Œ í•˜ë©´ Vercelì´ ì•Œì•„ì„œ ì—…ë¡œë“œë¥¼ í•´ì¤ë‹ˆë‹¤. `scripts/build.mjs` ìŠ¤í¬ë¦½íŠ¸ëŠ” ê° ëª¨ë…¸ë ˆí¬ë¥¼ ëŒë©´ì„œ ë¹Œë“œí•˜ê³  ê·¸ ìª½ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.

`pacakge.json`ì—ì„œ í”„ë¡œì íŠ¸ íƒ€ì…ì€ `type: "module"`ë¡œ ê°‘ë‹ˆë‹¤. ì‹¤ì œ ëŸ°íƒ€ì„ì—ë„ Node.jsì™€ í° ì—°ê´€ì´ ìˆëŠ” ì„œë²„ì™€ ë‹¬ë¦¬ í”„ë¡ íŠ¸ëŠ” `type: "module"` ì„ ì ìš©í•´ë„ ì´ì œëŠ” í° ë¬´ë¦¬ê°€ ì—†ì–´ ë³´ì…ë‹ˆë‹¤. Viteë¡œ ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ ë•Œ ì´ë¯¸ ê·¸ê²Œ ê¸°ë³¸ê°’ì´ê¸°ë„ í•˜êµ¬ìš”. ê·¸ë˜ì„œ ì „ë¶€ `type: "module"` ì…ë‹ˆë‹¤.

### Vite ë¹Œë“œ ì„¤ì • (library mode + IIFE)

Vite ê¸°ë³¸ ë¹Œë“œëŠ” `index.html` ì¤‘ì‹¬ì´ì§€ë§Œ, ìš°ë¦¬ëŠ” **ì™¸ë¶€ ì‚¬ì´íŠ¸ì— ì‚½ì…ë  ë‹¨ì¼ ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼**ì´ í•„ìš”í•©ë‹ˆë‹¤. ê·¸ë˜ì„œ ê° íŒ¨í‚¤ì§€ì˜ `vite.config`ì—ì„œ **library mode**ë¥¼ ì¼œê³  ì¶œë ¥ í¬ë§·ì„ `iife`ë¡œ ê³ ì •í–ˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ìŠ¤í¬ë¦½íŠ¸ê°€ ë¡œë“œë˜ëŠ” ì¦‰ì‹œ ì‹¤í–‰ë˜ëŠ” í˜•íƒœë¡œ ë–¨ì–´ì§‘ë‹ˆë‹¤.

```ts packages/main/vite.config.mts
import { defineConfig } from "vite";

export default defineConfig({
  build: {
    lib: {
      entry: "src/main.ts",
      formats: ["iife"],
      fileName: () => "main.js",
      name: "BannerMain",
    },
  },
});
```

`live-locator`ë„ ê°™ì€ íŒ¨í„´ìœ¼ë¡œ `entry`, `name`, `fileName`ë§Œ ë°”ê¿”ì£¼ë©´ ë©ë‹ˆë‹¤.

## `main` ìŠ¤í¬ë¦½íŠ¸

`main` ìŠ¤í¬ë¦½íŠ¸ëŠ” ì‹¬í”Œí•´ìš”. `banner-locations.json` íŒŒì¼ì„ ê°–ê³  ì™€ì„œ ê±°ê¸°ì˜ ì •ë³´ì— ë§ê²Œ ë°°ë„ˆë¥¼ insert í•´ì£¼ëŠ” ê²Œ ì „ë¶€ì…ë‹ˆë‹¤.

```ts packages/main/src/main.ts
async function init(): Promise<void> {
  window.__BANNER_TOOL__ = {
    version,
  };

  const configUrl = new URL("banner-locations.json", window.location.href).href;
  const response = await fetch(configUrl, { cache: "no-store" });
  const config = (await response.json()) as BannerConfig;

  for (const location of config.locations) {
    insertBannerAt(location);
  }

  await loadLiveLocator(); // ì¡°ê¸ˆ ìˆë‹¤ê°€ ì•Œì•„ë´…ì‹œë‹¤
}

// !mark(1:11)
if (document.readyState === "loading") {
  document.addEventListener(
    "DOMContentLoaded",
    () => {
      void init();
    },
    { once: true },
  );
} else {
  void init();
}
```

`main.js`ëŠ” ê³ ê°ì´ ì‚½ì…í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ì¸ ì ì„ í•­ìƒ ìœ ì˜í•´ì•¼ í•©ë‹ˆë‹¤. ê·¸ë˜ì„œ ë³¸ ìŠ¤í¬ë¦½íŠ¸ê°€ `head`ì— ì‚½ì…ë˜ì–´ ìˆë‹¤ë©´ ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ë˜ëŠ” ì‹œì ì— bodyê°€ ì—†ì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ê·¸ ë•Œ `init` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤ë©´ **ì•„ë¬´ëŸ° ë™ì‘ì„ í•˜ì§€ ì•ŠëŠ” ë¬¸ì œ**ê°€ ìˆìŠµë‹ˆë‹¤! ê·¸ë˜ì„œ `document.readyState`ë¥¼ ì²´í¬í•˜ê³  `DOMContentLoaded` ì´ë²¤íŠ¸ë¥¼ í™œìš©í•˜ì—¬ `init` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.

json íŒŒì¼ì€ ì•„ë˜ì™€ ê°™ì´ ë‹¨ìˆœí•˜ê²Œ ë˜ì–´ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ selectorë¥¼ ì°¾ì•„ì„œ ê·¸ ë‹¤ìŒ ìœ„ì¹˜ì— ë„£ëŠ” í–‰ë™ì„ í•©ë‹ˆë‹¤.

```ts packages/main/public/banner-locations.json
{
  "locations": [
    { "selector": "#banner-slot" },
    { "selector": "#section2 .banner-placeholder" }
  ]
}
```

`insertBannerAt`ì€ selector ë‹¤ìŒì— ë°°ë„ˆë¥¼ ë§Œë“¤ì–´ ë„£ëŠ” ì¼ë§Œ í•©ë‹ˆë‹¤.

```ts packages/main/src/main.ts
function insertBannerAt(location: BannerLocation): void {
  const banner = document.createElement("div");
  banner.className = "banner-tool-banner";
  banner.style.padding = "12px";
  banner.style.margin = "8px 0";
  banner.style.backgroundColor = "#1f2937";
  banner.style.color = "#f9fafb";
  banner.style.borderRadius = "8px";
  banner.style.fontFamily =
    "system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif";
  banner.style.boxShadow = "0 4px 10px rgba(0,0,0,0.15)";
  banner.dataset.bannerTool = "banner";
  banner.textContent = "This is a banner injected by Banner Tool";

  const target = document.querySelector(location.selector);
  if (!target || !target.parentElement) {
    console.warn(`[banner-tool] Selector not found: ${location.selector}`);
    return;
  }

  // !mark
  target.insertAdjacentElement("afterend", banner);
}
```

[insertAdjacentElement](https://developer.mozilla.org/en-US/docs/Web/API/Element/insertAdjacentElement) ë©”ì†Œë“œë¥¼ í™œìš©í•˜ë©´ elementë¥¼ ì›í•˜ëŠ” ìœ„ì¹˜ì— ë„£ê¸° ì¢‹ìŠµë‹ˆë‹¤. ì•„ë˜ëŠ” InsertPositionì— ë”°ë¼ ì‚½ì…ë˜ëŠ” ìœ„ì¹˜ì…ë‹ˆë‹¤.

```html
<!-- beforebegin -->
<p>
  <!-- afterbegin -->
  foo
  <!-- beforeend -->
</p>
<!-- afterend -->
```

## `live-locator` ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œí•˜ê¸°

í‹€ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

1. `liveLocator` searchParamsê°€ ìˆëŠ”ì§€ ì²´í¬í•˜ê³ , `"1"`ì´ë©´ `live-locator`ë¥¼ **ë¡œë“œí•œë‹¤.**
2. `banner-live-locator` Custom Elementê°€ ë“±ë¡ë˜ì—ˆëŠ”ì§€ ê¸°ë‹¤ë¦°ë‹¤ ([`whenDefined`](https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry/whenDefined))
3. `banner-live-locator` íƒœê·¸ë¥¼ ë§Œë“¤ì–´ `body`ì˜ ê°€ì¥ ë§ˆì§€ë§‰ì— ì‚½ì…í•œë‹¤.

```ts packages/main/src/main.ts
const LIVE_LOCATOR_TAG = "banner-live-locator";
let liveLocatorScriptPromise: Promise<void> | null = null;

async function loadLiveLocator(): Promise<void> {
  const param = new URL(window.location.href).searchParams.get("liveLocator");
  if (param !== "1") {
    return;
  }

  try {
    if (!liveLocatorScriptPromise) {
      // !mark
      // live-locatorë¥¼ ë¶ˆëŸ¬ì™€ì•¼ í•˜ëŠ” ë¶€ë¶„
    }

    await liveLocatorScriptPromise;
    await customElements.whenDefined(LIVE_LOCATOR_TAG);

    let element = document.querySelector(
      LIVE_LOCATOR_TAG,
    ) as HTMLElement | null;
    if (!element) {
      element = document.createElement(LIVE_LOCATOR_TAG);
      element.setAttribute("version", version);
      document.body.appendChild(element);
    } else {
      element.setAttribute("version", version);
    }
  } catch (error) {
    liveLocatorScriptPromise = null;
    console.warn("[banner-tool] Failed to bootstrap live locator", error);
  }
}
```

ì €ê¸°ì— ì–´ë–¤ ë¡œì§ì´ ë“¤ì–´ê°€ì•¼ í• ê¹Œìš”?

ì¼ë‹¨ ìš´ì˜ í™˜ê²½ë¶€í„° ë¨¼ì € ìƒê°í•´ë´…ì‹œë‹¤. ìš°ë¦¬ëŠ” ë‹¤ìŒê³¼ ê°™ì´ `main.js`ì™€ `live-locator.js`ë¥¼ ê°™ì€ ë„ë©”ì¸ìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì–´ë‘˜ ê²ƒì…ë‹ˆë‹¤.

- https://mini-multi-scripts-live-locator.vercel.app/main.js
- https://mini-multi-scripts-live-locator.vercel.app/live-locator/live-locator.js

`https://mini-multi-scripts-live-locator.vercel.app` ë¼ëŠ” ë„ë©”ì¸ì„ ê·¸ëŒ€ë¡œ ì´ìš©í•´ë„ ë˜ê² ì§€ë§Œ ì¡°ê¸ˆì´ë‚˜ë§ˆ ìœ ì—°ì„±ì„ ì˜¬ë¦¬ê¸° ìœ„í•´ì„œ ìš°ë¦¬ëŠ” [`import.meta.url`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/import.meta)ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `import.meta.url`ì€ ëª¨ë“ˆë¡œ ì‚½ì…ëœ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ìê¸° ìì‹ ì´ importëœ urlì„ ì•Œ ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤. ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš©í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```ts packages/main/src/main.ts
function loadScript(url: string, id: string): Promise<void> {
  // ë‚´ìš© ì¤‘ëµ. createElement("script")ë¥¼ í•˜ê³  headì— ì‚½ì….
  // PromiseëŠ” load ë˜ë©´ resolve í•˜ë„ë¡ ì„¤ì •.
}

// !mark(1:4)
const url = new URL(
  /* @vite-ignore */ `live-locator/live-locator.js?v=${version}`,
  import.meta.url,
).href;
liveLocatorScriptPromise = loadScript(url, "banner-live-locator-prod");
```

ê·¸ëŸ°ë° `/* @vite-ignore */` ì£¼ì„ì€ ì™œ ë¶™ì–´ìˆë‚˜ìš”? ì´ê±¸ ë¶™ì´ì§€ ì•Šìœ¼ë©´ ì•„ë˜ ê²½ê³ ê°€ ëœ¨ëŠ”ë°ìš”,

> new URL(\`live-locator/live-locator.js?v=$\{version\}\`, import.meta.url) doesn't exist at build time, it will remain unchanged to be resolved at runtime. If this is intended, you can use the /\* @vite-ignore \*/ comment to suppress this warning.

ê¸°ë³¸ì ìœ¼ë¡œ ViteëŠ” ë¹Œë“œí•  ë•Œ URL ê´€ë ¨ëœ ê±´ ì–´ë–»ê²Œë“  í•´ì„í•˜ë ¤ê³  í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ê°€ë³€ ê²½ë¡œëŠ” ë¹Œë“œ íƒ€ì„ ë•Œ ë³€í™˜í•  ìˆ˜ ì—†ëŠ” ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. Viteì˜ ê²°ê³¼ë¬¼ì— ë§ì¶°ì„œ ê²½ë¡œê°€ ë§Œë“¤ì–´ì§€ì§€ ì•Šê¸° ë•Œë¬¸ì— ì´ëŠ” ì¼ë°˜ì ì¸ ìƒí™©ì—ì„œëŠ” ì—ëŸ¬ê°€ ëœ° í™•ë¥ ì´ êµ‰ì¥íˆ ë†’ìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ìš°ë¦¬ëŠ” ì´ í–‰ë™ì„ ì˜ë„í–ˆìŠµë‹ˆë‹¤(`live-locator`ëŠ” `main`ê³¼ëŠ” ì—°ê´€ì´ ì—†ëŠ” ë³„ë„ì˜ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤). ê·¸ëŸ¬ë¯€ë¡œ `/* @vite-ignore */` ì£¼ì„ì„ ë¶™ì—¬ì¤ë‹ˆë‹¤.

ì´ì œ dev í™˜ê²½ì—ì„œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ê°€ì ¸ì™€ë´…ì‹œë‹¤.

```ts packages/main/src/main.ts
// !mark(1:6)
if (import.meta.env.DEV) {
  liveLocatorScriptPromise = loadScript(
    "http://localhost:5174/src/live-locator.tsx",
    "banner-live-locator-dev",
  );
} else {
  const url = new URL(
    /* @vite-ignore */ `live-locator/live-locator.js?v=${version}`,
    import.meta.url,
  ).href;
  liveLocatorScriptPromise = loadScript(url, "banner-live-locator-prod");
  // !mark
}
```

ì°¸ê³ ë¡œ `import.meta.env.DEV` ëŠ” Viteì—ì„œë§Œ íŠ¹ë³„í•˜ê²Œ ì·¨ê¸‰í•˜ëŠ” ê°’ì…ë‹ˆë‹¤. ê·¸ë˜ì„œ ë§Œì•½ ë¹Œë“œí•˜ê²Œ ë˜ë©´ `import.meta.env.DEV`ëŠ” `false`ë¡œ ê°„ì£¼ë˜ì–´ ìœ„ì—ì„œ ìƒ‰ì¹ í•œ ì½”ë“œëŠ” ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤.

## Custom Element ë° Shadow DOM êµ¬í˜„í•˜ê¸°

`live-locator`ëŠ” ì•„ë˜ì™€ ê°™ì´ ìƒê²¼ìŠµë‹ˆë‹¤.

```tsx packages/live-locator/src/live-locator.tsx
import { createRoot, Root } from "react-dom/client";
import { LiveLocatorApp } from "./LiveLocatorApp";
import { StrictMode } from "react";

const ELEMENT_TAG = "banner-live-locator";

declare global {
  interface HTMLElementTagNameMap {
    "banner-live-locator": BannerLiveLocatorElement;
  }
}

type ElementState = {
  root: Root;
  version: string;
};

// !mark
class BannerLiveLocatorElement extends HTMLElement {
  private state: ElementState | null = null;

  static get observedAttributes(): string[] {
    return ["version"];
  }

  // !mark
  connectedCallback(): void {
    if (this.state) {
      return;
    }

    // !mark
    const shadowRoot = this.shadowRoot ?? this.attachShadow({ mode: "open" });

    // !mark
    // LiveLocatorAppë¥¼ shaodwRootì— ë Œë”ë§í•œë‹¤!!

    this.state = { root, version };

    console.log("[banner-tool] Live Locator mounted", { version });
  }

  // !mark
  disconnectedCallback(): void {
    this.state?.root.unmount();
    this.state = null;
    console.log("[banner-tool] Live Locator unmounted");
  }

  attributeChangedCallback(
    name: string,
    oldValue: string | null,
    newValue: string | null,
  ): void {
    // ì¤‘ëµ
  }
}

export function defineLiveLocatorElement(): void {
  // !mark(1:4)
  if (!customElements.get(ELEMENT_TAG)) {
    customElements.define(ELEMENT_TAG, BannerLiveLocatorElement);
    console.log("[banner-tool] Live Locator element defined");
  }
}

defineLiveLocatorElement();
```

ì¤‘ìš”í•œ ê±´ ìƒ‰ê¹”ì„ ì¹ í–ˆìŠµë‹ˆë‹¤.

- Custom ElementëŠ” **HTMLElementë¥¼ ìƒì† ë°›ëŠ” í´ë˜ìŠ¤**ë¡œ ì •ì˜í•˜ê³  ì¶”í›„ **customElements.define**ë¡œ ë“±ë¡í•©ë‹ˆë‹¤. (customElementsëŠ” ì „ì—­ ê°ì²´ì…ë‹ˆë‹¤)
- íŠ¹ë³„í•œ ì—­í• ì„ í•˜ëŠ” ì—¬ëŸ¬ ë©”ì†Œë“œê°€ ìˆìŠµë‹ˆë‹¤.
  - **connectedCallback**: documentì— ì¶”ê°€ë  ë•Œë§ˆë‹¤ í˜¸ì¶œë©ë‹ˆë‹¤.
  - **disconnectedCallback**: documentë¡œë¶€í„° ì‚­ì œë  ë•Œë§ˆë‹¤ í˜¸ì¶œë©ë‹ˆë‹¤.
  - **attributeChangedCallback**: ì†ì„±ì´ ì¶”ê°€/ì‚­ì œ/ìˆ˜ì •ë  ë•Œë§ˆë‹¤ í˜¸ì¶œë©ë‹ˆë‹¤.
- `this.attachShadow({ mode: "open" });`ìœ¼ë¡œ Shadow DOMì„ ì´ ìš”ì†Œì— ë¶™ì´ê³  ê±°ê¸°ì—ë‹¤ê°€ React ì•±ì„ ê·¸ë¦½ë‹ˆë‹¤.

> - Custom Elementì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ [MDN ë¬¸ì„œ Using custom elements](https://developer.mozilla.org/en-US/docs/Web/API/Web_components/Using_custom_elements)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.
> - Shadow DOMì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ [MDN ë¬¸ì„œ Using shadow DOM](https://developer.mozilla.org/en-US/docs/Web/API/Web_components/Using_shadow_DOM)ì„ ì°¸ì¡°í•˜ì„¸ìš”.

ì ì¼ë‹¨ ì—¬ê¸°ê¹Œì§€ë§Œ í•´ë„ `[banner-tool] Live Locator mounted` ë¡œê·¸ëŠ” ì½˜ì†”ì— ì˜ ëœ° ê²ë‹ˆë‹¤.

ì¼ë‹¨ `LiveLocatorApp`ëŠ” ì•„ë˜ì™€ ê°™ì´ ëŒ€ì¶© ë§Œë“­ì‹œë‹¤.

```tsx packages/live-locator/src/LiveLocatorApp.tsx
type LiveLocatorAppProps = {
  version: string;
  onClose: () => void;
};

export function LiveLocatorApp({ version, onClose }: LiveLocatorAppProps) {
  return <div>hello world!</div>;
}
```

ì´ì œ ë‹¤ì‹œ ëŒì•„ì™€ì„œ ë Œë”ë§ì„ í•´ë³¼ê¹Œìš”?

```tsx packages/live-locator/src/live-locator.tsx
// ìƒëµ

connectedCallback(): void {
  if (this.state) {
    return;
  }

  const shadowRoot = this.shadowRoot ?? this.attachShadow({ mode: "open" });

  // !mark(1:14)
  const mountPoint = document.createElement("div");
  mountPoint.id = "banner-live-locator-root";
  shadowRoot.append(mountPoint);

  const version = this.getAttribute("version") ?? "dev";

  const root = createRoot(mountPoint);
  const handleClose = () => { /* ì¤‘ëµ */ };

  root.render(
    <StrictMode>
      <LiveLocatorApp version={version} onClose={handleClose} />
    </StrictMode>
  );

  this.state = { root, version };

  console.log("[banner-tool] Live Locator mounted", { version });
}

// í›„ëµ
```

`this.attachShadow` í˜¸ì¶œë¡œ ë°›ì€ Shadow Rootì— divë¥¼ í•˜ë‚˜ ë„£ê³ , ê·¸ divë¡œ `createRoot` í•´ë²„ë¦¬ê³  React ì•±ì„ `render` í•©ë‹ˆë‹¤! ì•—? ê·¸ëŸ°ë° ë§ì…ë‹ˆë‹¤... í˜¹ì‹œ ë‹¤ìŒê³¼ ê°™ì€ ì—ëŸ¬ê°€ ëœ¨ë‚˜ìš”? ğŸ¤¯ğŸ¤¯ğŸ¤¯

```txt
Uncaught Error: @vitejs/plugin-react can't detect preamble. Something is wrong.
```

ê³„ì†í•´ì„œ í•´ ë´…ì‹œë‹¤ìš”. ì´ ì—ëŸ¬ëŠ” ë¬´ì—‡ì´ê³ , ë¬¸ì œë¥¼ ì–´ë–»ê²Œ ì ‘ê·¼í• ì§€ ì¢€ ìƒì„¸íˆ ì„¤ëª…í•  ì˜ˆì •ì…ë‹ˆë‹¤.

<ArticleImage
  img={stair}
  alt="ì²œêµ­ì˜ ê³„ë‹¨. ëì—†ì´ ë‚˜ì˜¤ëŠ” ê³„ë‹¨."
  border
  caption="ëì—†ì´ ë‚˜ì˜¤ëŠ” ì—ëŸ¬"
/>

---

### ì°¸ê³ : ì†Œì†Œí•˜ê²Œ íƒ€ì… ì§€ì› ë°›ê¸°

ì•„ë˜ì™€ ê°™ì´ íƒ€ì…ì„ ì§€ì •í•œë‹¤ë©´ `document.createElement` í•  ë•Œ íƒ€ì… ì§€ì›ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```ts
declare global {
  interface HTMLElementTagNameMap {
    "banner-live-locator": BannerLiveLocatorElement;
  }
}

/** BannerLiveLocatorElement  */
const element = document.createElement("banner-live-locator");
```

---

## HMR ë™ì‘í•˜ê²Œ í•˜ê¸°

preambleì´ë¼ëŠ” ë‚¯ì„  ì˜ë‹¨ì–´ê°€ ë“±ì¥í–ˆë„¤ìš”. ê²€ìƒ‰í•´ë³´ë‹ˆ ë‹¤ìŒê³¼ ê°™ì€ ëœ»ì´ ìˆë‹¤ê³  í•©ë‹ˆë‹¤.

> í”„ë¦¬ì•°ë¸”(Preamble)ì€ í†µì‹ ì—ì„œ ë°ì´í„° ì „ì†¡ ì‹œì‘ ì „ì— ì†¡ì‹ ìì™€ ìˆ˜ì‹ ì ê°„ì˜ íƒ€ì´ë°ê³¼ ì£¼íŒŒìˆ˜ ë™ê¸°ë¥¼ ë§ì¶”ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ì„œë‘ ì‹ í˜¸

ê·¸ë‚˜ì €ë‚˜ `Something is wrong`ì´ë¼ë‹ˆìš”... ì´ëŸ° ë¶ˆì¹œì ˆí•œ ì—ëŸ¬ ë©”ì‹œì§€...!! ê°œë°œ ì„œë²„ì—ì„œ ì´ˆê¸°í™”ë˜ì–´ ìˆì–´ì•¼ í•  ì •ë³´ë“¤ì´ ì—†ë‚˜ë´…ë‹ˆë‹¤. ê·¸ë˜ì„œ HMRì€ ì»¤ë…• ì•„ì˜ˆ ë¡œë”©ì¡°ì°¨ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

React ë“±ì˜ ê°œë°œ í™˜ê²½ì—ì„œëŠ” ìƒì‚°ì„±ë„ ì¤‘ìš”í•˜ê¸° ë•Œë¬¸ì— í”„ë ˆì„ì›Œí¬ ì°¨ì›ì—ì„œ í¸ë¦¬í•œ ê¸°ëŠ¥ì„ ì œê³µí•´ì¤ë‹ˆë‹¤. HMR í˜¹ì€ Fast Refreshë¡œ ë¶ˆë¦¬ìš°ëŠ”, **íŒŒì¼ì„ ì €ì¥í•˜ë©´ ìë™ìœ¼ë¡œ ë³€ê²½ì‚¬í•­ì´ ì ìš©ë˜ëŠ” ê¸°ëŠ¥** ë˜í•œ ê·¸ ì¼í™˜ì…ë‹ˆë‹¤. HMRì´ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ëŠ” ì¢€ ë” ìì„¸íˆ ë´…ì‹œë‹¤. ì•„ë˜ëŠ” `npm run dev` ìœ¼ë¡œ ê°œë°œ ì„œë²„ë¥¼ ë„ì› ì„ ë•Œ ëª¨ìŠµì…ë‹ˆë‹¤.

```txt
  VITE v7.3.0  ready in 261 ms

  âœ  Local:   http://localhost:5173/
  âœ  Network: use --host to expose
  âœ  press h + enter to show help

  VITE v7.3.0  ready in 457 ms

  âœ  Local:   http://localhost:5174/
  âœ  Network: use --host to expose
  âœ  press h + enter to show help
```

ê°œë°œ ì„œë²„ê°€ ë‘ ê°œ ë– ìˆëŠ” ëª¨ìŠµì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 5173 í¬íŠ¸ëŠ” `main` ìª½ í”„ë¡œì íŠ¸ì´ê³  5174ëŠ” `live-locator` ìª½ì…ë‹ˆë‹¤. ìš°ë¦¬ê°€ `http://localhost:5173/` ë¼ëŠ” ê²½ë¡œë¡œ ì ‘ê·¼í•˜ê²Œ ë˜ë©´ ë¡œì»¬ì— ë– ìˆëŠ” ì„œë²„ëŠ” ê·¸ ê²½ë¡œë¥¼ ë¶„ì„í•´ ëŒ€ëµ ë‹¤ìŒê³¼ ê°™ì€ ì ˆì°¨ë¡œ ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.

1. ë¸Œë¼ìš°ì €ê°€ `http://localhost:5173` ë˜ëŠ” í•˜ìœ„ íŒŒì¼ (`http://localhost:5173/src/main.ts?t=123`)ì— ì ‘ê·¼í•©ë‹ˆë‹¤.
1. ê°œë°œ ì„œë²„ëŠ” í•´ë‹¹ ê²½ë¡œì— ìˆëŠ” ì‹¤ì œ ë¡œì»¬ íŒŒì¼ì„ ì½ìŠµë‹ˆë‹¤.
1. ê°œë°œ ì„œë²„ëŠ” íŒŒì¼ì„ ì ë‹¹íˆ ë³€í™˜í•˜ê³  **HMR ê¸°ëŠ¥ì„ í¬í•¨í•œ ê°œë°œ í¸ì˜ì„± ì½”ë“œ ìŠ¤ë‹ˆí«ì„ ì¶”ê°€ë¡œ ë¼ì›Œ ë„£ê³ ** ë¸Œë¼ìš°ì €ì—ê²Œ ì „ë‹¬í•©ë‹ˆë‹¤.
1. ë¸Œë¼ìš°ì €ëŠ” ìŠ¤ë‹ˆí«ì— í¬í•¨ë˜ì–´ ìˆëŠ” ê°œë°œ ë„êµ¬ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤. (ì˜ˆ: `http://localhost:5173/@vite/client`)
1. í•´ë‹¹ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì„œë²„ì™€ WebSocketì„ ì—°ê²°í•©ë‹ˆë‹¤.
1. ë˜í•œ ë¸Œë¼ìš°ì €ëŠ” **ì¶”í›„ ì„œë²„ë¡œë¶€í„° ì‹ í˜¸ê°€ ì™”ì„ ë•Œì˜ ë™ì‘ì„ íŒŒì¼ë³„ë¡œ ë¯¸ë¦¬ ì •ì˜**í•´ ë†“ìŠµë‹ˆë‹¤. ì´ê²ƒë„ ìŠ¤ë‹ˆí«ì— í¬í•¨ë˜ì–´ ìˆëŠ” ë‚´ìš©ì…ë‹ˆë‹¤. ë³´í†µ `accept`ë¼ëŠ” í•¨ìˆ˜ë¥¼ ë¯¸ë¦¬ ì •ì˜í•˜ëŠ”ë°ìš”, ìƒˆë¡­ê²Œ ë°”ë€ ìš”ì†Œë¥¼ ì ìš©í•œë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.

ì, ê·¸ëŸ¼ ìœ„ `@vitejs/plugin-react can't detect preamble.` ì—ëŸ¬ëŠ” ì–´ë””ì„œ ë°œìƒí•˜ëŠ” ê±¸ê¹Œìš”?

```js LiveLocatorApp.tsx ê°œë°œìš© ë¹Œë“œ ê²°ê³¼ë¬¼ (ë„¤íŠ¸ì›Œí¬ íƒ­ì—ì„œ í™•ì¸ ê°€ëŠ¥)
import { createHotContext as __vite__createHotContext } from "/@vite/client";
import.meta.hot = __vite__createHotContext("/src/LiveLocatorApp.tsx");
// ******************************
// ì¤‘ëµ. ì‹¤ì œ LiveLocatorApp ë‚´ìš©
// ******************************
import * as RefreshRuntime from "/@react-refresh";
if (import.meta.hot) {
  if (!window.$RefreshReg$) {
    // !mark(1:3)
    throw new Error(
      "@vitejs/plugin-react can't detect preamble. Something is wrong.",
    );
  }
  RefreshRuntime.__hmr_import(import.meta.url).then((currentExports) => {
    RefreshRuntime.registerExportsForReactRefresh(
      "/Users/th.kim/Desktop/mini-multi-scripts/packages/live-locator/src/LiveLocatorApp.tsx",
      currentExports,
    );
    import.meta.hot.accept((nextExports) => {
      if (!nextExports) return;
      const invalidateMessage =
        RefreshRuntime.validateRefreshBoundaryAndEnqueueUpdate(
          "/Users/th.kim/Desktop/mini-multi-scripts/packages/live-locator/src/LiveLocatorApp.tsx",
          currentExports,
          nextExports,
        );
      if (invalidateMessage) import.meta.hot.invalidate(invalidateMessage);
    });
  });
}
```

ì•ì„œ ì´ì•¼ê¸°í•œ ì¤€ë¹„ ë‹¨ê³„ ì¤‘ 6ë‹¨ê³„, **ì¶”í›„ ì„œë²„ë¡œë¶€í„° ì‹ í˜¸ê°€ ì™”ì„ ë•Œì˜ ë™ì‘ì„ íŒŒì¼ë³„ë¡œ ë¯¸ë¦¬ ì •ì˜í•´ ë†“ëŠ”** ë‹¨ê³„ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí•œ ê²ë‹ˆë‹¤. ê·¸ë ‡ë‹¤ë©´ ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš”?

ë‹¤ì‹œ ìƒí™©ì„ ì •ë¦¬í•´ë´…ì‹œë‹¤.

1. ê°œë°œìš© ì„œë²„ì— ì§„ì…í•œë‹¤ (`http://localhost:5173`) â†’ `index.html` íŒŒì¼ì´ ë¡œë“œë¨
1. ë¸Œë¼ìš°ì €ëŠ” `main.ts` íŒŒì¼ë„ ìš”ì²­í•œë‹¤. (`http://localhost:5173/src/main.ts`)
1. ë¸Œë¼ìš°ì €ëŠ” live-locatorê°€ ìˆëŠ” `http://localhost:5174/src/live-locator.tsx` íŒŒì¼ì„ ìš”ì²­í•œë‹¤.
1. ì¤„ì¤„ì´ `http://localhost:5174/src/LiveLocatorApp.tsx` ë„ ìš”ì²­í•œë‹¤.
1. ì¤€ë¹„í•˜ëŠ” ê³¼ì •ì—ì„œ ì—ëŸ¬!

---

ë³´í†µ ìš°ë¦¬ëŠ” Reactë¥¼ Vite í™˜ê²½ì—ì„œ ê°œë°œí•  ë•Œ `index.html` íŒŒì¼ì´ ìˆë‹¤ëŠ” ê±¸ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ íŒŒì¼ì— ë¹„ë°€ì´ ìˆ¨ê²¨ì ¸ ìˆì—ˆìŠµë‹ˆë‹¤.

<ArticleImage
  img={su}
  alt="ìŠ¤ë‹ˆí«ì´ `index.html`ì—ë„ ì‚½ì…ë˜ì–´ ìˆìŒ"
  border
  caption="ìŠ¤ë‹ˆí«ì´ `index.html`ì—ë„ ì‚½ì…ë˜ì–´ ìˆìŒì„ ë³¼ ìˆ˜ ìˆë‹¤"
/>

Vite ì…ì¥ì—ì„œëŠ”, `live-locator`ë¥¼ ê°€ì ¸ì˜¤ëŠ” `index.html` íŒŒì¼ì— **ë¯¸ë¦¬ ìŠ¤ë‹ˆí«ì„ ì˜ ë¼ì›Œ ë„£ì–´ì„œ** ê° íŒŒì¼ì—ì„œë„ ì¤€ë¹„ ê³¼ì •ì— ì—ëŸ¬ê°€ ì—†ì–´ì•¼ í•˜ëŠ” ê²Œ ë‹¹ì—°í•œë°, ìš°ë¦¬ëŠ” `index.html` íŒŒì¼ì€ ê±´ë„ˆë›°ê³  ì§ì ‘ `live-locator`ë¥¼ ë¡œë“œí–ˆìœ¼ë‹ˆ ViteëŠ” ì´ìƒí•¨ì„ ê°ì§€í•˜ê³  ê·¸ëƒ¥ ì¢…ë£Œì‹œì¼œë²„ë¦° ê²ƒì…ë‹ˆë‹¤.

í•´ê²°ë²•ì€ ê°„ë‹¨í•©ë‹ˆë‹¤. `main.ts`ì—ì„œ ì € preamble ì½”ë“œë¥¼ ì§ì ‘ ì‚½ì…í•˜ë©´ ë©ë‹ˆë‹¤.

```ts packages/main/src/main.ts
if (import.meta.env.DEV) {
  // !diff(1:9) +
  const script = document.createElement("script");
  script.type = "module";
  script.textContent = `
  import { injectIntoGlobalHook } from "http://localhost:5174/@react-refresh";
  injectIntoGlobalHook(window);
  window.$RefreshReg$ = () => {};
  window.$RefreshSig$ = () => (type) => type;
`;
  document.head.appendChild(script);

  liveLocatorScriptPromise = loadScript(
    "http://localhost:5174/src/live-locator.tsx",
    "banner-live-locator-dev",
  );
} else {
  const url = new URL(
    /* @vite-ignore */ `live-locator/live-locator.js?v=${version}`,
    import.meta.url,
  ).href;
  liveLocatorScriptPromise = loadScript(url, "banner-live-locator-prod");
}
```

`"/@react-refresh"` ê°€ ì•„ë‹ˆë¼ `"http://localhost:5174/@react-refresh"`ë¡œë¶€í„° ëª¨ë“ˆì„ ê°€ì ¸ì˜¨ë‹¤ëŠ” ì ì— ìœ ì˜í•˜ì„¸ìš”. ì´ì œ ë”ì´ìƒ `@vitejs/plugin-react can't detect preamble` ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•Šê³  ìš°ë¦¬ì˜ `LiveLocatorApp` ì´ ì˜ ë¡œë“œëœë‹¤ëŠ” ê±¸ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

ì € ì½”ë“œê°€ ì–´ë””ì„œ ì–´ë–»ê²Œ ë§Œë“¤ì–´ì§€ëŠ” ì§€ëŠ” ì•„ë˜ì™€ ê°™ì´ Vite ì†ŒìŠ¤ì½”ë“œì—ì„œë„ í™•ì¸í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<ArticleImage
  img={preamble}
  alt="React Vite Plugin preamble ì½”ë“œ"
  border
  caption={
    <span className="break-all">
      React Vite Plugin preamble ì½”ë“œ.{" "}
      <a href="https://github.com/Vitejs/Vite-plugin-react/blob/main/packages/common/refresh-utils.ts">
        https://github.com/Vitejs/Vite-plugin-react/blob/main/packages/common/refresh-utils.ts
      </a>
    </span>
  }
/>

## Tailwind

Tailwind CSS ë¥¼ ì ìš©í•˜ë ¤ë©´ [ê³µì‹ ë¬¸ì„œë¥¼ ì¼ë‹¨ ë”°ë¼í•˜ë©´](https://tailwindcss.com/docs/installation/using-vite) ë©ë‹ˆë‹¤.

1. Tailwind ì„¤ì¹˜ `npm install tailwindcss @tailwindcss/vite`
2. `vite.config.ts`ì— tailwindcss í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€
3. CSS íŒŒì¼ì— `@import "tailwindcss";` ì¶”ê°€ (CSS íŒŒì¼ì€ ì–´ë””ì„ ê°€ import ë˜ì–´ì•¼ í•¨)

ë³¸ë˜ Reactì—ì„œ í•˜ë˜ ê²ƒì²˜ëŸ¼ `LiveLocatorApp` ì—ì„œ ê·¸ css íŒŒì¼ì„ import í•´ë´…ì‹œë‹¤.

```tsx packages/live-locator/src/LiveLocatorApp.tsx
import "./live-locator.css";
```

ê·¸ëŸ°ë° ë¬¸ì œê°€ ìƒê¹ë‹ˆë‹¤.

<ArticleImage
  img={t1}
  alt="headì— ì‚½ì…ë˜ëŠ” Tailwind style íƒœê·¸"
  border
  caption="headì— ì‚½ì…ë˜ëŠ” Tailwind style íƒœê·¸"
/>

**ìš°ë¦¬ì˜ ìŠ¤íƒ€ì¼ì€ headì— ìƒê¸°ë©´ ì•ˆ ë©ë‹ˆë‹¤.** ê³ ê° ì‚¬ì´íŠ¸ì— ì˜í–¥ì„ ì£¼ë©´ ì•ˆë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤(ì‹¬ì§€ì–´ í”„ë¡œë•ì…˜ ë¹Œë“œëŠ” ê·¸ëƒ¥ ì´ìƒí•˜ê²Œ ë™ì‘í•´ì„œ, CSS íŒŒì¼ ì§„ì…ì  ìì²´ê°€ ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤) ê³ ê° ì‚¬ì´íŠ¸ì™€ ê²©ë¦¬í•˜ê¸° ìœ„í•´ Shadow DOMì„ì„ ì±„íƒí•œ ë§Œí¼, Tailwindë„ Shaodw DOMì˜ ë°”ìš´ë”ë¦¬ ë‚´ì—ì„œ ë™ì‘í•˜ê²Œë” í•´ì•¼ í•©ë‹ˆë‹¤. ë¬¸ì œëŠ”, Shadow DOMì—ì„œë„ ì˜ ë™ì‘í•˜ë„ë¡ Tailwindê°€ ì„¤ê³„ëœ ê±´ ì•„ë‹ˆë€ ê²ƒì…ë‹ˆë‹¤. ì´ë¥¼ ë¬¸ì œ ì—†ì´ ì˜ ë™ì‘í•˜ë„ë¡ í•˜ëŠ” ê±´ ìš°ë¦¬ì˜ ë¯¸ì…˜ì´ë¼ëŠ” ê²ë‹ˆë‹¤.

ë‹¤í–‰íˆë„ ì‰½ê²Œ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx packages/live-locator/src/LiveLocatorApp.tsx
// !mark
import styles from "./live-locator.css?inline";

type LiveLocatorAppProps = {
  version: string;
  onClose: () => void;
};

export function LiveLocatorApp({ version, onClose }: LiveLocatorAppProps) {
  return (
    <>
      {/* !mark */}
      <style>{styles}</style>
      <div>hello world!</div>
    </>
  );
}
```

[Vite ë¬¸ì„œ](https://vite.dev/guide/features#disabling-css-injection-into-the-page)ì— ë”°ë¥´ë©´ `?inline`ì„ ë¶™ì´ë©´ ë‹¨ìˆœ string ê°’ìœ¼ë¡œ ìŠ¤íƒ€ì¼ì˜ ë‚´ìš©ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤ê³  í•©ë‹ˆë‹¤.

> **Disabling CSS injection into the page**
>
> The automatic injection of CSS contents can be turned off via the `?inline` query parameter. In this case, the processed CSS string is returned as the module's default export as usual, but the styles aren't injected to the page.

ê·¸ë˜ì„œ ê·¸ê±¸ ìŠ¤íƒ€ì¼ì— ê·¸ëŒ€ë¡œ ë„£ìœ¼ë©´ ë©ë‹ˆë‹¤. ê·¸ëŸ¼ ì•„ë˜ ì´ë¯¸ì§€ì™€ ê°™ì´ Shadow DOM ë‚´ì— ìŠ¤íƒ€ì¼ì´ ì‚½ì…ë˜ì—ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìš°ë¦¬ì˜ `style` íƒœê·¸ëŠ” ê³ ê°ì˜ ì‚¬ì´íŠ¸ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

<ArticleImage
  img={t2}
  alt="Shadow DOM ì•ˆì— ì‚½ì…ë˜ëŠ” style íƒœê·¸"
  border
  caption="Shadow DOM ì•ˆì— ì‚½ì…ë˜ëŠ” style íƒœê·¸"
/>

ë‹¤ë¥¸ ë¬¸ì œë„ ìˆìŠµë‹ˆë‹¤. [Shadow DOM ë‚´ë¶€ì—ì„œëŠ” CSS `@property` ê¸°ëŠ¥ì´ ë™ì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. (tailwindcss#15005)](https://github.com/tailwindlabs/tailwindcss/issues/15005). Tailwind ë¬¸ì œëŠ” ì•„ë‹ˆê³  í‘œì¤€ì´ ì •í•´ì§€ì§€ ì•Šì€ ë¬¸ì œë¼ ë¸Œë¼ìš°ì €ì—ì„œ êµ¬í˜„ë„ ë˜ì§€ ì•Šì€ ìƒíƒœì…ë‹ˆë‹¤. ì €ëŠ” border ìŠ¤íƒ€ì¼ë§Œ ì •í•´ì§€ì§€ ì•Šì•„ì„œ ë¬¸ì œë¥¼ ì‚´í´ë´¤ì—ˆëŠ”ë°ìš”, Tailwind v4ëŠ” `border-style`ì´ `@property`ë¡œì„œ ê¸°ë³¸ê°’ì´ ì •í•´ì§€ëŠ”ë°, ì´ ê¸°ë³¸ê°’ ì¡°ì°¨ Shadow DOM ë‚´ë¶€ì—ì„œ ìœ íš¨í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ì•„ì˜ˆ ì•ˆë³´ì˜€ë˜ ê²ƒì…ë‹ˆë‹¤!

ê·¸ë˜ì„œ ì•„ë˜ ë‚´ìš©ë„ CSS íŒŒì¼ì— ì¶”ê°€í•´ì¤¬ìŠµë‹ˆë‹¤.

```css packages/live-locator/src/live-locator.css
:host {
  --tw-divide-y-reverse: 0;
  --tw-border-style: solid;
  --tw-font-weight: initial;
  --tw-tracking: initial;
  --tw-translate-x: 0;
  --tw-translate-y: 0;
  --tw-translate-z: 0;
  --tw-rotate-x: rotateX(0);
  --tw-rotate-y: rotateY(0);
  --tw-rotate-z: rotateZ(0);
  --tw-skew-x: skewX(0);
  --tw-skew-y: skewY(0);
  --tw-space-x-reverse: 0;
  --tw-gradient-position: initial;
  --tw-gradient-from: #0000;
  --tw-gradient-via: #0000;
  --tw-gradient-to: #0000;
  --tw-gradient-stops: initial;
  --tw-gradient-via-stops: initial;
  --tw-gradient-from-position: 0%;
  --tw-gradient-via-position: 50%;
  --tw-gradient-to-position: 100%;
  --tw-shadow: 0 0 #0000;
  --tw-shadow-color: initial;
  --tw-inset-shadow: 0 0 #0000;
  --tw-inset-shadow-color: initial;
  --tw-ring-color: initial;
  --tw-ring-shadow: 0 0 #0000;
  --tw-inset-ring-color: initial;
  --tw-inset-ring-shadow: 0 0 #0000;
  --tw-ring-inset: initial;
  --tw-ring-offset-width: 0px;
  --tw-ring-offset-color: #fff;
  --tw-ring-offset-shadow: 0 0 #0000;
  --tw-blur: initial;
  --tw-brightness: initial;
  --tw-contrast: initial;
  --tw-grayscale: initial;
  --tw-hue-rotate: initial;
  --tw-invert: initial;
  --tw-opacity: initial;
  --tw-saturate: initial;
  --tw-sepia: initial;
  --tw-drop-shadow: initial;
  --tw-duration: initial;
  --tw-ease: initial;
}
```

## Trouble Shooting

### ë¹Œë“œ ê²°ê³¼ë¬¼ì— process.env.NODE_ENV ê°€ ìˆì–´ìš”

ì´ ë¬¸ì œëŠ” Vite ì—ì„œ library mode ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ë‚˜ì˜¤ëŠ” ë¬¸ì œì…ë‹ˆë‹¤.

library modeëŠ” ë§ ê·¸ëŒ€ë¡œ **ê²°ê³¼ë¬¼ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ì‚¬ìš©ë˜ë„ë¡ ë¹Œë“œ**í•©ë‹ˆë‹¤. ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ê°œë°œìë“¤ì´ ì‚¬ìš©í•˜ëŠ” ê²ë‹ˆë‹¤. ìµœì¢… ê³ ê°ì—ê²Œ ì „ë‹¬ë˜ëŠ” ê²Œ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ê°œë°œê³¼ ê´€ë ¨ëœ ì •ë³´ë„ ë‚¨ì•„ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ë¹Œë“œ í¬ë§·ì„ `es`ë¡œ í•œë‹¤ë©´ íŠ¸ë¦¬ì…°ì´í‚¹ê³¼ ê´€ë ¨ëœ ì •ë³´(`/*@__PURE__*/` ì£¼ì„ ë“±)ë¥¼ ë³´ì¡´í•˜ê¸° ìœ„í•´ ê³µë°±ì„ ê·¸ëŒ€ë¡œ ë‚¨ê²¨ë†“ìŠµë‹ˆë‹¤.

`live-locator`ì—ëŠ” Reactê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ React ê°œë°œì— í•„ìš”í•œ ì •ë³´ë„ í•¨ê»˜ ë‹´ê²¨ì ¸ ìˆê³ , Node.jsì—ì„œ `live-locator`ê°€ ë˜ë‹¤ì‹œ ë¹Œë“œë  ê²ƒì„ ì „ì œë¡œ í•˜ì—¬ `process.env.NODE_ENV` ì— ë”°ë¥¸ ë¶„ê¸° ì²˜ë¦¬ë„ ë³´ì¡´ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ëŸ°ë° `live-locator`ëŠ” ë¸Œë¼ìš°ì €ì—ì„œ êµ¬ë™ë˜ì–´ì•¼ í•˜ê³  ì—„ë°€íˆ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì•„ë‹ˆë¼ ìµœì¢… ê²°ê³¼ë¬¼ì…ë‹ˆë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ì •ë³´ë¥¼ ë³´ì¡´í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.

ì•„ë˜ì™€ ê°™ì´ `build` ëª…ë ¹ì–´ë¼ë©´ `process.env.NODE_ENV`ë¥¼ `"production"`ìœ¼ë¡œ ê³ ì •í•¨ìœ¼ë¡œì¨ ë¹Œë“œ ê²°ê³¼ë¬¼ì— `process.env.NODE_ENV`ë¥¼ ì „ë¶€ ë‚ ë ¤ë²„ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```ts packages/live-locator/vite.config.mts
import tailwindcss from "@tailwindcss/vite";
import react from "@vitejs/plugin-react";
import { defineConfig } from "vite";

export default defineConfig(({ command }) => ({
  // ì¤‘ëµ
  define:
    command === "build"
      ? { "process.env.NODE_ENV": '"production"' }
      : undefined,
  // ì¤‘ëµ
}));
```

## ë§ˆì¹˜ë©°

Production-Ready ë¼ê³  ì œëª©ì— ì¨ë„£ì–´ë‘ê¸´ í–ˆì§€ë§Œ ì‹¤ì œ ì„œë¹„ìŠ¤ì— ì ìš©í•  ë• í•´ì•¼ í•  ê²Œ ë” ë§ê¸´ í•©ë‹ˆë‹¤. íŠ¹íˆ `live-locator`ì™€ ê°™ì€ ê¸°ëŠ¥ì´ ë¡œë“œë˜ëŠ” ê±´ ê¶Œí•œ ì²´í¬(ê´€ë¦¬ì ì¸ì¦)ê°€ í•„ìš”í•˜ì£ . ê·¸ì™¸ ì—ëŸ¬/ë¡œê·¸ ìˆ˜ì§‘ê³¼ ê°™ì€ ìš´ì˜ì— í•„ìš”í•œ ë¶€ë¶„ë„ ì‹ ê²½ì¨ì•¼ í•  ê²ƒì…ë‹ˆë‹¤.

ë‹¤ë¥¸ ì‚¬ì´íŠ¸ì—ì„œ ë™ì‘í•˜ëŠ” ì•±ì„ ë§Œë“ ë‹¤ëŠ” ê±´, ì •ë§ ì–´ë µìŠµë‹ˆë‹¤. ê¸°ì¡´ ë„êµ¬ë“¤ì€ ê·¸ëŸ° ìƒí™©ì„ ì „ì œí•´ë†“ì§€ ì•Šì•˜ì£ , ì‚¬ì´íŠ¸ëŠ” ê±´ë“œë¦¬ë©´ ì•ˆë˜ì£ , ë˜í•œ ì‚¬ì´íŠ¸ë¡œë¶€í„° ì˜í–¥ì„ ë°›ì•„ì„œë„ ì•ˆë©ë‹ˆë‹¤. ê°ì¢… ì œì•½ì€ ë§ìœ¼ë©´ì„œë„ ê°œë°œ ìƒì‚°ì„±ë„ ì¢‹ì•„ì•¼ í•˜ì£ . ì´ ê¸€ì—ì„œëŠ” `main`ê³¼ `live-locator`ë¥¼ ë¶„ë¦¬í•˜ê³ , ì¡°ê±´ë¶€ ë¡œë”©, Shadow DOM ê²©ë¦¬, Vite HMR ë³´ì • ê°™ì€ í˜„ì‹¤ì ì¸ ë¬¸ì œë¥¼ í•˜ë‚˜ì”© í•´ê²°í•´ë´¤ìŠµë‹ˆë‹¤.

ì‹¤ì œë¡œ ì´ëŸ° ì•±ì„ ë§Œë“ ë‹¤ë©´ ì´ ê¸€ì— ì“°ì—¬ì§„ ê²ƒ ë§ê³ ë„ ê¸°ìƒì²œì™¸í•œ ë¬¸ì œë“¤ì„ ë§ì´ ê²ªê²Œ ë˜ì‹¤ ê²ë‹ˆë‹¤. ë¸Œë¼ìš°ì €ê°€ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ë™ì‘í•˜ê³ , Viteì™€ ê°™ì€ ë²ˆë“¤ëŸ¬ê°€ ì½”ë“œë¥¼ ì–´ë–»ê²Œ ë§Œë“¤ê³ , í”„ë¡ íŠ¸ ì•±ì˜ ê°œë°œ ë° ë¹Œë“œ í™˜ê²½ì´ ì–´ë–»ê²Œ êµ¬ì„±ë˜ì–´ ìˆëŠ”ì§€ì— ëŒ€í•´ì„œ ì´í•´ë¥¼ í•˜ê³  ìˆë‹¤ë©´! ë‚œê´€ì„ ì˜ í•´ì³ë‚˜ê°€ì‹¤ ìˆ˜ ìˆì„ ê²ë‹ˆë‹¤.

## ë ˆí¼ëŸ°ìŠ¤

- [Andar ê³µì‹ ì‚¬ì´íŠ¸](https://andar.co.kr/)
- [Beusable ê³µì‹ ì‚¬ì´íŠ¸](https://www.beusable.net/)
- [CREMA ê³µì‹ ì‚¬ì´íŠ¸](https://www.cre.ma/)
- [Google Tag Manager](https://tagmanager.google.com/)
- [Vercel Live Feedback ìŠ¤í¬ë¦½íŠ¸ (ë‚œë…í™”)](https://vercel.live/_next-live/feedback/feedback.js)
- [mini-multi-scripts GitHub ì €ì¥ì†Œ](https://github.com/echoja/mini-multi-scripts)
- [mini-multi-scripts ë¼ì´ë¸Œ ë°ëª¨](https://mini-multi-scripts-live-locator.vercel.app/)
- [Amazon S3](https://aws.amazon.com/ko/s3)
- [MDN: Element.insertAdjacentElement](https://developer.mozilla.org/en-US/docs/Web/API/Element/insertAdjacentElement)
- [MDN: CustomElementRegistry.whenDefined](https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry/whenDefined)
- [ë°ëª¨ main.js (ë‚œë…í™”)](https://mini-multi-scripts-live-locator.vercel.app/main.js)
- [ë°ëª¨ live-locator.js (ë‚œë…í™”)](https://mini-multi-scripts-live-locator.vercel.app/live-locator/live-locator.js)
- [MDN: import.meta](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/import.meta)
- [MDN: Using custom elements](https://developer.mozilla.org/en-US/docs/Web/API/Web_components/Using_custom_elements)
- [MDN: Using shadow DOM](https://developer.mozilla.org/en-US/docs/Web/API/Web_components/Using_shadow_DOM)
- [Vite Plugin React refresh utils](https://github.com/Vitejs/Vite-plugin-react/blob/main/packages/common/refresh-utils.ts)
- [Tailwind CSS Installation Guide (using Vite)](https://tailwindcss.com/docs/installation/using-vite)
- [Vite: Disabling CSS injection into the page](https://vite.dev/guide/features#disabling-css-injection-into-the-page)
- [Tailwind CSS Issue "@property isn't supported in shadow roots" #15005](https://github.com/tailwindlabs/tailwindcss/issues/15005)
