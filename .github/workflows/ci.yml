name: CI

on:
  pull_request:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v3

      - uses: supabase/setup-cli@v1
        with:
          version: 1.5.4

      - uses: pnpm/action-setup@v2.2.2
        with:
          version: 7.11.0

      - name: 로컬 개발 환경에서 Supabase 실행
        run: supabase start

      - name: 생성된 타입이 최신 버전인지 체크
        run: |
          pnpm gen
          if [ "$(git diff --ignore-space-at-eol src/modules/supabase/supabase-types.ts | wc -l)" -gt "0" ]; then
            echo "아래 변경사항이 적용되지 않았습니다."
            git diff
            exit 1
          fi
